define("confluence/attachments",["ajs","confluence/templates","confluence/api/ajax","confluence/api/constants","confluence/message-controller"],function(c,a,n,k,o){function l(b){clearTimeout(m);e&&(c.log("Preventing submit due to recent form submission."),b.preventDefault());e=!0;m=setTimeout(function(){e=false},2E3)}var j={showOlderVersions:function(b){b(".attachment-history a").click(function(i){var f=b(this).parents("table.attachments"),a=b(this).parents("tr:first")[0].id.substr(11),f=b(".history-"+
a,f);b(this).toggleClass("icon-section-opened");b(this).toggleClass("icon-section-closed");f.toggleClass("hidden");return c.stopEvent(i)})}},e=!1,m;return{component:j,initialiser:function(b){function i(c,a){return b(c).parents("["+a+"]").attr(a)}function f(a,e,f){var g=c.ConfluenceDialog({width:600,height:200,id:"attachment-removal-confirm-dialog"});g.addHeader(e);g.addPanel("",f);g.addSubmit(c.I18n.getText("ok"),function(){var e;e={};n.ajax({type:"POST",url:a,data:e,success:function(){location.reload(!0)},
error:function(d){var a=[];a.push(o.parseError(d));d.responseText&&(d=b.parseJSON(d.responseText),d.actionErrors&&(a=d.actionErrors));d=c.ConfluenceDialog({width:600,height:200,id:"attachment-removal-error-dialog"});d.addHeader(h.removalErrorTitle());d.addPanel("",h.removalErrorBody({messages:a}));d.addButton(c.I18n.getText("close.name"),function(){location.reload(true)});d.show();d.updateHeight();g.remove()}})});g.addCancel(c.I18n.getText("cancel.name"),function(){g.remove()});g.show()}b("#upload-attachments").on("submit",
l);var e=b("#more-attachments-link");e.click(function(a){b(".more-attachments").removeClass("hidden");e.addClass("hidden");return c.stopEvent(a)});j.showOlderVersions(b);var h=a.Attachments;b(".removeAttachmentLink").click(function(){j.showRemoveAttachmentConfirmDialog(this);return!1});b(".removeAttachmentLinkVersion").click(function(){f(k.CONTEXT_PATH+"/json/removeattachmentversion.action"+this.search,h.versionRemovalConfirmationTitle(),h.versionRemovalConfirmationBody({filename:i(this,"data-attachment-filename"),
version:i(this,"data-attachment-version")}));return!1});j.showRemoveAttachmentConfirmDialog=function(a){var b=k.CONTEXT_PATH+"/json/removeattachment.action"+a.search,c=h.removalConfirmationTitle(),a=h.removalConfirmationBody({filename:i(a,"data-attachment-filename")});f(b,c,a)}},submitHandler:l}});require("confluence/module-exporter").safeRequire("confluence/attachments",function(c){var a=require("ajs");a.Attachments=c.component;a.toInit(c.initialiser)});