define("confluence/attachments",["ajs","confluence/templates","confluence/api/ajax","confluence/api/constants","confluence/message-controller"],function(e,t,n,o,a){var i,r={showOlderVersions:function(t){t(".attachment-history a").click(function(n){var o=t(this).parents("table.attachments"),a=t(this).parents("tr:first")[0].id.substr(11),i=t(".history-"+a,o);return t(this).hasClass("icon-section-opened")?t(this).toggleClass("icon-section-opened").attr("aria-expanded","false").toggleClass("icon-section-closed"):t(this).hasClass("icon-section-closed")&&t(this).toggleClass("icon-section-closed").attr("aria-expanded","true").toggleClass("icon-section-opened"),i.toggleClass("hidden"),e.stopEvent(n)})}},s=!1;function c(t){clearTimeout(i),s&&(e.log("Preventing submit due to recent form submission."),t.preventDefault()),s=!0,i=setTimeout(function(){s=!1},2e3)}return{component:r,initialiser:function(i){i("#upload-attachments").on("submit",c);var s=i("#more-attachments-link");s.click(function(t){return i(".more-attachments").removeClass("hidden"),s.addClass("hidden"),e.stopEvent(t)}),r.showOlderVersions(i);var l=t.Attachments;function m(e,t){return i(e).parents("["+t+"]").attr(t)}function u(e){return m(e,"data-attachment-filename")}function d(t){return e.ConfluenceDialog({width:600,height:200,id:t})}function h(t,o,r){var s=d("attachment-removal-confirm-dialog");s.addHeader(o),s.addPanel("",r),s.addSubmit(e.I18n.getText("ok"),function(){var o,r,c,m;o=t,c=function(){location.reload(!0)},m=function(t){var n=[];if(n.push(a.parseError(t)),t.responseText){var o=i.parseJSON(t.responseText);o.actionErrors&&(n=o.actionErrors)}var r=d("attachment-removal-error-dialog");r.addHeader(l.removalErrorTitle()),r.addPanel("",l.removalErrorBody({messages:n})),r.addButton(e.I18n.getText("close.name"),function(){location.reload(!0)}),r.show(),r.updateHeight(),s.remove()},r=(r=null)||{},n.ajax({type:"POST",url:o,data:r,success:c,error:m})}),s.addCancel(e.I18n.getText("cancel.name"),function(){s.remove()}),s.show()}function f(e,t){return o.CONTEXT_PATH+e+t}i(".removeAttachmentLink").click(function(){return r.showRemoveAttachmentConfirmDialog(this),!1}),i(".removeAttachmentLinkVersion").click(function(e){var t;return h(f("/json/removeattachmentversion.action",this.search),l.versionRemovalConfirmationTitle(),l.versionRemovalConfirmationBody({filename:u(this),version:(t=this,m(t,"data-attachment-version"))})),!1}),r.showRemoveAttachmentConfirmDialog=function(e){h(f("/json/removeattachment.action",e.search),l.removalConfirmationTitle(),l.removalConfirmationBody({filename:u(e)}))}},submitHandler:c}}),require("confluence/module-exporter").safeRequire("confluence/attachments",function(e){var t=require("ajs");t.Attachments=e.component,t.toInit(e.initialiser)});