define("confluence/tree",["jquery","ajs","window","document"],function(e,t,i,n){"use strict";var r={tree:function(e){if(!this.is(".ui-tree"))return new s.tree(this,e)}},o=function(e){e.preventDefault()},s={tree:function(r,a){var l=r,d=this,p=!1,h=arguments;if(!/^[ou]l$/i.test(l[0].tagName)){if(p=!0,!a.url)return!1;l.html("<ul></ul>"),l=e("ul",l)}var c=l[0];l.addClass("ui-tree");var u={list:l,visibleNodes:[],dim:l.offset(),points:[],win:e(i),timer:null,prev:0,events:{grab:function(){},click:function(){},drag:function(){},drop:function(){},append:function(){},insertabove:function(){},insertbelow:function(){},load:function(){},nodeover:function(){},nodeout:function(){},onready:function(){},order:function(){},orderUndo:function(){},remove:function(){},preview:function(){}}};function v(){u.visibleNodes=[];for(var t=e("li:visible",c),i=0,n=t.length;i<n;i++)e(t[i]).hasClass("tree-helper")||(t[i].num=u.visibleNodes.length,u.visibleNodes.push(new w(t[i])));x()}function f(e,t){e=(e+"").toLowerCase(),t=(t+"").toLowerCase();for(var i=/(\d+|\D+)/g,n=e.match(i),r=t.match(i),o=Math.max(n.length,r.length),s=0;s<o;s++){if(s===n.length)return-1;if(s===r.length)return 1;var a=parseInt(n[s],10),l=parseInt(r[s],10);if(a==n[s]&&l==r[s]&&a!=l)return(a-l)/Math.abs(a-l);if((a!=n[s]||l!=r[s])&&n[s]!=r[s])return n[s]<r[s]?-1:1}return 0}function m(t,i,n){var r=e(".click-zone:first",t);t.removeClass("opened closed").addClass(i),n(r)}function g(e){e.removeClass("aui-icon aui-icon-small aui-iconfont-chevron-right aui-iconfont-chevron-down")}function b(e){g(e),e.addClass("aui-icon aui-icon-small aui-iconfont-chevron-down")}function N(e){g(e),e.addClass("aui-icon aui-icon-small aui-iconfont-chevron-right")}function $(i){if(this[0]=i[0],this.$=i,this.text=i.find("span").text(),this.href=i.find("a").attr("href"),this.linkClass=i.find("a").attr("class"),this.nodeClass=i.attr("class"),this.open=function(e){if(u.visibleNodes.length)return u.visibleNodes[this[0].num].open&&u.visibleNodes[this[0].num].open(e);t.log("tried to open empty node")},this.insertChild=function(e){e.$&&(e=e[0]),u.visibleNodes[this[0].num].append(e)},this.reorder=function(){u.visibleNodes[this[0].num].order(f)},this.close=function(){u.visibleNodes[this[0].num].close()},this.getAttribute=function(e){return this[0][e]},this.setAttribute=function(e,t){this[0][e]=t},this.highlight=function(){this.$.addClass("highlighted")},this.unhighlight=function(){this.$.removeClass("highlighted")},this.makeDraggable=function(){this.setAttribute("undraggable",!1),this.$.removeClass("undraggable")},this.makeUndraggable=function(){this.setAttribute("undraggable",!0),this.$.addClass("undraggable")},this.makeClickable=function(t){this.setAttribute("unclickable",!1),this.$.removeClass("unclickable");var i,n=this[0].getElementsByTagName("a");(i=e(t?n[0]:n)).unbind("click",o),i.click(u.events.click)},this.makeUnclickable=function(t){this.setAttribute("unclickable",!0),this.$.addClass("unclickable");var i,n=this[0].getElementsByTagName("a");(i=e(t?n[0]:n)).click(o),i.unbind("click",u.events.click)},this.setText=function(e){this.text=e,this[0].text=e,this.$.find("span").text(e)},this.getParent=function(){if(this.$.parent(":not(.ui-tree)").length){var t=this.$.parent().parent();if(t.length)return new $(e(t[0]))}return null},this.append=function(e){var t=this.$.find("ul");if(!t.length){if(this[0].toBeLoaded){var i=this;return this.open(function(){i.append(e)}),!1}this.$.append("<ul></ul>"),t=this.$.find("ul")}var n=q(e);t.append(n),E.call(n),void 0===this[0].closed&&(this.$.addClass("closed"),this[0].closed=!0,t.hide()),v()},this.below=function(e){var t=q(e);this.$.after(t),E.call(t),v()},this.above=function(e){var t=q(e);this.$.before(t),E.call(t),v()},this.remove=function(){this.$.remove(),v()},this.reload=function(){this[0].getElementsByTagName("ul").length&&(this[0].removeChild(this[0].getElementsByTagName("ul")[0]),m(this.$,"closed",N),this[0].closed=!0,u.visibleNodes[this[0].num].open())},this.order=function(t){var i=e("ul",this.$),n=this[0];if(n.ordered=!0,i.length){var r=[];n.oldorder=[],e("li",this.$).each(function(){r.push(this),n.oldorder.push(this)}),r.sort(function(i,n){return t(e(i).find("span").html(),e(n).find("span").html())}),n.order=r;for(var o=0,s=r.length;o<s;o++)i.append(r[o])}v()},this.orderUndo=function(){this[0].ordered=!1;var t=e("ul",this.$);if(this[0].oldorder&&t.length)for(var i=0,n=this[0].oldorder.length;i<n;i++)t.append(this[0].oldorder[i]);this[0].oldorder=null,v()},this.setOrdered=function(t){this[0].ordered=t,e("a.abc:first",this).css("display",t?"none":"block"),e("a.rollback:first",this).css("display","none")},d.options.parameters&&d.options.parameters.length)for(var n=0,r=d.options.parameters.length;n<r;n++)i[0][d.options.parameters[n]]&&(this[d.options.parameters[n]]=i[0][d.options.parameters[n]])}for(var C in this.options=a,this.updateVisibleNodes=v,this.expandPath=function(e,t){if(t=t||function(){},e.length){var i,n,r=1,o=function(){if(r<e.length){for(var n in e[r])if(i=d.findNodeBy(n,e[r][n]))break;r++,i.open(o)}else t()};for(n in e[0]){i=this.findNodeBy(n,e[0][n]);break}if(!i)return;i.open(o)}else t()},this.reload=function(e){for(var t in p&&l.remove(),e)this.options[t]=e[t];return new h.callee(r,this.options)},this.append=function(e){var t=q(e);l.append(t),E.call(t),v()},this.unhighlight=function(){l.find("li.highlighted").each(function(t,i){e(this).removeClass("highlighted")})},this.findNodeBy=function(t,i){for(var n=[],r=c.getElementsByTagName("li"),o=0,s=r.length;o<s;o++)r[o][t]==i&&n.push(new $(e(r[o])));return 0===n.length?null:1===n.length?n[0]:n},u.events)"function"==typeof a[C]&&(u.events[C]=a[C]);function y(t){return!("li"===t.tagName.toLowerCase()&&e("li:not(.tree-helper)",t).length<1)}function w(t){this.$li=e(t),this.height=this.$li.height()}function k(e){var t=u.points[e];return void 0!==t?{visibleNode:u.visibleNodes[t.num],where:t.where,top:t.top}:{visibleNode:new w(c),where:"append",top:u.dim.top}}function x(){var e={y:0,num:0};u.points=[];for(var t=0,i=u.visibleNodes.length;t<i;t++){var n,r,o,s=u.visibleNodes[t].$li.offset(),a=Math.round(s.top);if(u.visibleNodes[t].top=a,u.visibleNodes[t].left=Math.round(s.left),e.y)for(n=(a-e.y)/4,r=e.y;r<a;r++)o=r-e.y<n?"above":r-e.y<3*n?"append":"below",u.points[r]={num:e.num,where:o,top:e.y};if(t==i-1)for(n=u.visibleNodes[t].height/4,r=a;r<a+u.visibleNodes[t].height;r++)o=r-a<n?"above":r-a<3*n?"append":"below",u.points[r]={num:t,where:o,top:a};e.y=a,e.num=t}}w.prototype.append=function(t){if(this.$li[0]==t)return!1;if(this.$li[0].toBeLoaded){var i=this;return this.load(function(){i.append(t)}),!1}if("li"===this.$li[0].tagName.toLowerCase()){var r=e("ul:first",this.$li),o=t.parentNode.parentNode;e(".rollback:first",o).css("display","none"),r.length?(r.append(t),this.$li[0].ordered&&this.order(f)):((r=n.createElement("ul")).appendChild(t),this.$li[0].appendChild(r),m(this.$li,"opened",b),e(".click-zone:first",this.$li).attr("aria-label","Collapse Page Tree").attr("aria-expanded","true"),e(".click-zone:first",this.$li).css("display","inline"),e(".rollback:first",this.$li).css("display","none")),y(o)||u.visibleNodes[o.num].notaFolderAnymore(),setTimeout(v,0),u.events.append.call({source:t,target:this.$li[0]})}},w.prototype.below=function(t){var i=t.parentNode.parentNode;this.$li.after(t),e(".rollback:first",i).css("display","none"),y(i)?e(t.parentNode).hasClass("ui-tree")||t.parentNode.parentNode.undraggable||(t.parentNode.parentNode.ordered=!1,e(".abc:first",t.parentNode.parentNode).css("display","block"),e(".rollback:first",t.parentNode.parentNode).css("display","none")):u.visibleNodes[i.num].notaFolderAnymore(),setTimeout(v,0),u.events.insertbelow.call({source:t,target:this.$li[0]})},w.prototype.above=function(t){var i=t.parentNode.parentNode;this.$li.before(t),e(".rollback:first",i).css("display","none"),y(i)?e(t.parentNode).hasClass("ui-tree")||t.parentNode.parentNode.undraggable||(t.parentNode.parentNode.ordered=!1,e(".abc:first",t.parentNode.parentNode).css("display","block"),e(".rollback:first",t.parentNode.parentNode).css("display","none")):u.visibleNodes[i.num].notaFolderAnymore(),setTimeout(v,0),u.events.insertabove.call({source:t,target:this.$li[0]})},w.prototype.order=function(t){var i=this.$li[0];i.ordered=!0;var n=e("ul:first",this.$li);if(n.length){var r=[];i.oldorder=[],e("li",this.$li).each(function(){this.parentNode.parentNode==i&&(r.push(this),i.oldorder.push(this))}),r.sort(function(i,n){var r=e("span",i).text().replace(/^\s+|\s+$/g,""),o=e("span",n).text().replace(/^\s+|\s+$/g,"");return t(r,o)}),i.order=r;for(var o=0,s=r.length;o<s;o++)n.append(r[o])}v()},w.prototype.orderUndo=function(){var t=this.$li[0];t.ordered=!1;var i=e("ul:first",this.$li);if(t.oldorder&&i.length&&i[0].parentNode==t)for(var n=0,r=t.oldorder.length;n<r;n++)i.append(t.oldorder[n]);t.oldorder=null,t.oldor=null,v()},w.prototype.open=function(t){if(t=t||function(){},this.$li.hasClass("closed")){var i=e("ul:has(li)",this.$li);return i.length?(i.show(),this.closed=!1,m(this.$li,"opened",b),e(".click-zone:first",this.$li).attr("aria-label","Collapse Page Tree").attr("aria-expanded","true"),v(),t(!0),!0):this.load(t)}return t(!1),!1},w.prototype.close=function(e){e=e||function(){};var t=this.$li.contents().filter("ul:has(li)");t.length&&(t.hide(),this.closed=!0,m(this.$li,"closed",N),u.visibleNodes.splice(this.$li[0].num+1,t[0].getElementsByTagName("li").length),v(),e())},w.prototype.load=function(t){var i=d.options.url;if(!i)return!1;t=t||function(){},this.$li[0].toBeLoaded=!1,this.$li[0].closed=!0;var r={};if(a.parameters&&a.parameters.length)for(var o=0,s=a.parameters.length;o<s;o++)r[a.parameters[o]]=this.$li[0][a.parameters[o]]||"";var l=this,p=(this.$li[0].getElementsByTagName("span")[0],e(".button-panel",this.$li[0]));l.loading=!0,p.spin({left:"10px"});return e.ajax({url:i,type:"GET",dataType:"json",data:r,success:function(i){var r=e("ul",l.$li);r.length||(r=n.createElement("ul"),l.$li[0].appendChild(r),r=e(r)),l.ordered="number"!=typeof i[0].position;for(var o=0,s=i.length;o<s;o++){var a=q(i[o]);r[0].appendChild(a),E.call(a)}r.hide(),l.open(t),u.events.load(),p.spinStop(),l.$li[0].ordered=l.ordered,e(".abc:first",l.$li[0]).css("display",l.ordered||a.undraggable?"none":"block"),e(".rollback:first",l.$li[0]).css("display","none")}}),!0},w.prototype.notaFolderAnymore=function(){m(this.$li,"",g),e(".click-zone:first",this.$li).hide(),e(".abc:first",this.$li).css("display","none"),e(".rollback:first",this.$li).css("display","none");var t=this.$li[0].getElementsByTagName("ul");this.closed=!1,t.length&&this.$li[0].removeChild(t[0])};var T=function(){var t={distance:3,helper:"clone",opacity:.7,cursorAt:{top:u.H/2,left:30},stop:function(e,i){clearInterval(u.timer),clearTimeout(u.opentimer),u.opentimer=null;var n=k(u.prev);n.visibleNode.$li.removeClass("over").removeClass("above").removeClass("append").removeClass("below"),n.visibleNode.$li.next().removeClass("over").removeClass("above").removeClass("append").removeClass("below"),u.win.unbind("keypress",u.escape),delete u.escape;for(var r=(n=k(e.pageY||e.originalEvent.pageY)).visibleNode.$li[0],o=!0;r!=c;){if(r==this){o=!1;break}r=r.parentNode}(o=o&&!("above"==n.where&&n.visibleNode.$li.prev()[0]==this)&&!("append"==n.where&&n.visibleNode.$li[0]==this.parentNode.parentNode))&&!0!==t.revert&&(n.visibleNode[n.where](this),u.events.drop.call({position:n.where,source:this,target:n.visibleNode.$li[0]}))},start:function(i,n){var r=this;n.helper.append("<strong></strong>").addClass("tree-helper").find(".button-panel").remove(),u.events.grab.call(r),this.undraggable&&(n.helper.addClass("no"),t.revert=!0),u.escape=function(i){if(27===i.keyCode){var o=k(u.prev);o.visibleNode.$li.removeClass("over").removeClass("above").removeClass("append").removeClass("below"),o.visibleNode.$li.next().removeClass("over").removeClass("above").removeClass("append").removeClass("below");var s=n.helper.clone();n.helper.before(s),s.animate({left:Math.round(e(r).offset().left)+"px",top:Math.round(e(r).offset().top)+"px",opacity:0},"slow","swing",function(){s.remove()}),n.helper.css("display","none"),t.revert=!0}},u.win.keypress(u.escape)},drag:function(e,n){e.pageY=e.pageY||e.originalEvent.pageY,e.pageX=e.pageX||e.originalEvent.pageX;var r=k(u.prev);if(r.visibleNode.$li.removeClass("above").removeClass("append").removeClass("below"),r.visibleNode.$li.next().removeClass("above").removeClass("append").removeClass("below"),!t.revert||u.out){u.prev=e.pageY;var o=k(u.prev);if(o.visibleNode.$li[0]==c)return t.revert=!0,void(u.out=!0);u.out&&(u.out=!1,t.revert=!1),o.visibleNode!=r.visibleNode&&(u.events.nodeout.call(r.visibleNode.$li),u.opentimer&&(clearTimeout(u.opentimer),u.opentimer=!1)),u.events.nodeover.call({element:o.visibleNode.$li,position:o.where});var s=o.where,a=o.visibleNode.$li.next();"below"==s&&a.length&&!a.hasClass("tree-helper")?a.addClass("above"):k(u.prev).visibleNode.$li.addClass(s),"append"!=o.where||!o.visibleNode.closed&&!o.visibleNode.$li[0].toBeLoaded||u.opentimer||(u.opentimer=function(e){return setTimeout(function(){e.visibleNode.$li.removeClass("append"),e.visibleNode.open(function(){u.opentimer=!1})},500)}(o));var l=arguments.callee;u.win.height()-e.pageY+u.win.scrollTop()<30?(clearInterval(u.timer),u.timer=setInterval(function(){i.scrollBy(0,4),n.helper.css("top",parseInt(n.helper.css("top"))+4+"px"),l({pageY:e.pageY+4},n)},u.win.height()-e.pageY+u.win.scrollTop())):u.win.scrollTop()>0&&e.pageY-u.win.scrollTop()<30?(clearInterval(u.timer),u.timer=setInterval(function(){i.scrollBy(0,-4),l({pageY:e.pageY-4},n),n.helper.css("top",parseInt(n.helper.css("top"))-4+"px")},e.pageY-u.win.scrollTop())):u.timer&&clearInterval(u.timer),u.events.drag.call({element:this,left:e.pageX,top:e.pageY})}}};return t};function E(){var t=e(this);d.options.undraggable?t.mousedown(o):(t.draggable(T()),t[0].undraggable=t.hasClass("undraggable"));var i=e(this.getElementsByTagName("a")[0]);d.options.unclickable?(t.addClass("unclickable"),i.click(o)):i.click(u.events.click),d.options.oninsert&&d.options.oninsert.call(new $(t),i)}s.tree.callNumber=0;var B=function(t){if(!u.visibleNodes[this.parentNode.num].loading)return e(this.parentNode).hasClass("closed")?(u.visibleNodes[this.parentNode.num].open(),e(this).attr("aria-expanded","true").attr("aria-label","Collapse Page Tree")):(u.visibleNodes[this.parentNode.num].close(),e(this).attr("aria-expanded","false").attr("aria-label","Expand Page Tree")),!1},Y=function(t){return e(t.target).hasClass("tree-helper")||e(".button-panel:first",this).addClass("hover"),!1},A=function(t){return e(t.target).hasClass("tree-helper")||e(".button-panel:first",this).removeClass("hover"),!1},I=function(){var t=u.visibleNodes[this.parentNode.parentNode.num];return t.order(f),u.events.order.call({source:t.$li[0]}),e(this).hide(),e("a.rollback",this.parentNode).show(),!1},P=function(t){var i=u.visibleNodes[this.parentNode.parentNode.num];return i.orderUndo(),u.events.orderUndo.call({source:i.$li[0],orderedChildren:e("ul:first",i.$li[0]).children()}),e(this).hide(),e("a.abc",this.parentNode).show(),!1},L=function(e){e.preventDefault();var t=u.visibleNodes[this.parentNode.parentNode.num];u.events.preview.call({source:preview,node:t.$li[0]})},U=function(e){e.preventDefault();var t=u.visibleNodes[this.parentNode.parentNode.num];u.events.remove.call({source:t.$li[0]})},j=function(t,i,r,o,s){var a=n.createElement(t),l=e(a);return l.addClass(i),l.attr("title",r),l.click(s),o||l.css("display","none"),a};function q(t){var i=n.createElement("li"),r=e(i);if(i.className=t.nodeClass,d.options.parameters&&d.options.parameters.length)for(var o=0,s=d.options.parameters.length;o<s;o++)t[d.options.parameters[o]]&&(i[d.options.parameters[o]]=t[d.options.parameters[o]]);d.options.nodeId&&(i.id="node-"+t[d.options.nodeId]);var a=n.createElement("a"),l=n.createElement("span"),p=n.createElement("i");p.className="decorator",a.href=t.href,l.appendChild(n.createTextNode(t.text)),a.appendChild(l),a.appendChild(p),a.className=t.linkClass;var h=j("div","click-zone","",!0,B);e(h).addClass("click-zone").attr("tabindex","0").attr("role","button"),e(h).keyup(function(t){13===t.keyCode&&e(this).click()}),r.mouseover(Y).mouseout(A),i.appendChild(h),i.appendChild(a);var c=n.createElement("div");c.className="button-panel",i.appendChild(c);var u=j("a","abc confluence-sidebar-open-alphabetical","Sort Alphabetically",!1,I);c.appendChild(u);var v=j("a","rollback aui-icon aui-icon-small aui-iconfont-undo","Undo Sorting",!1,P);if(c.appendChild(v),d.options.isAdministrator){var f=j("a","preview-node","Preview",!0,L);c.appendChild(f);var g=j("a","remove-node","Delete",!0,U);c.appendChild(g)}return r.hasClass("opened")?(m(r,"closed",N),e(h).attr("aria-label","Expand Page Tree").attr("aria-expanded","false"),i.closed=!0):r.hasClass("closed")?(m(r,"closed",N),e(h).attr("aria-label","Expand Page Tree").attr("aria-expanded","false"),i.toBeLoaded=!0):e(h).css("display","none"),i}var z=l.contents().filter("li");if(z.length>0)u.H=z.height(),z.each(E),v(),u.events.onready.call(this);else{var D=d.options.initUrl||d.options.url;if(!D)return!1;e(l).spin({left:"0%"});var M=++s.tree.callNumber;e.getJSON(D,function(t){for(var i=0,n=t.length;i<n;i++){var r=q(t[i]);c.appendChild(r),0===i&&(u.H=e(r).height()),E.call(r)}v(),e(l).spinStop(),M==s.tree.callNumber&&(u.events.onready.call(this),s.tree.callNumber=0)})}return u.offset=c.offsetTop,setInterval(function(){c.offsetTop!==u.offset&&(x(),u.offset=c.offsetTop)},10),this}};return{jqueryPlugin:r,ui:s}}),require("confluence/module-exporter").safeRequire("confluence/tree",function(e){"use strict";var t=require("jquery");t.ui=t.ui||{},t.fn.extend(e.jqueryPlugin),t.ui.tree=e.ui.tree});