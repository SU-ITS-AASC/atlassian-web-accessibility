AJS.toInit(function(d){function b(h,j,g,i,e){var f=h.attr("data-enabled")==="true";AJS.trigger("analytics",{name:"blueprint.template."+(f?"disable":"enable"),data:{}});d.ajax({url:g,type:f?"DELETE":"PUT",contentType:"application/vnd.atl.plugins.plugin.module+json",success:function(k){h.attr("data-enabled",!f);h.text(f?AJS.I18n.getText("enable.name"):AJS.I18n.getText("disable.name"));e.toggleClass("disabled",f);if(j){var l=h.siblings(".promoted-state-toggle-trigger");f?l.disable():l.enable()}},error:function(){AJS.log("Could not enable/disable blueprint with id: "+i)}});return false}d("#content-blueprint-templates .module-state-toggle-trigger").click(function(){var g=AJS.Meta.get("space-key")||d("meta[name=confluence-space-key]").attr("content"),h=d(this),e=h.closest(".web-item-module"),i=e.data("content-blueprint-id"),f=Confluence.getContextPath()+"/rest/create-dialog/1.0/modules/"+i+(g?"?spaceKey="+g:"");return b(h,true,f,i,e)});d("#space-blueprints-admin-table .module-state-toggle-trigger").click(function(){var g=d(this),e=g.closest(".web-item-module"),h=e.data("space-blueprint-id"),f=Confluence.getContextPath()+"/rest/create-dialog/1.0/modules/space-blueprint/"+h;return b(g,true,f,h,e)});d(".web-item-module .template-operations a").click(function(f){if(d(this).closest(".web-item-module").is(".disabled")){f.preventDefault();f.stopPropagation()}});var c=d(".promoted-state-toggle-trigger");c.tooltip({aria:true});c.click(function(e){var f=d(this),g=f.attr("data-promoted")==="true";a(f,g);e.preventDefault()});var a=function(e,h){var g=e,i=g.closest(".web-item-module").data("content-blueprint-id"),f=AJS.Meta.get("space-key");if(!f){f=d("meta[name=confluence-space-key]").attr("content")}g.disable();AJS.trigger("analytics",{name:"blueprint.template."+(h?"unpromote":"promote"),data:{}});d.ajax({url:Confluence.getContextPath()+"/rest/create-dialog/1.0/promotion/promote-blueprint/"+i+(f?"?spaceKey="+f:""),type:h?"DELETE":"PUT",contentType:"application/json"}).done(function(){g.attr("data-promoted",!h);g.text(h?AJS.I18n.getText("create.content.plugin.templates.promoted.name"):AJS.I18n.getText("create.content.plugin.templates.non.promoted.name"))}).fail(function(){AJS.log("Could not promote/demote blueprint with id: "+i)}).always(function(){g.enable()})}});