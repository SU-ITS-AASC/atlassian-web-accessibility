AJS.toInit(function(d){var c=AJS.Meta.get("space-key");if(!c){c=d("meta[name=confluence-space-key]").attr("content")}var b="/rest/create-dialog/1.0/promotion/promote-template/";d.ajax({url:Confluence.getContextPath()+b,data:{spaceKey:c},type:"GET",contentType:"application/json"}).done(function(e){d("#pagetemplates-table").find("tr[data-pagetemplate-id]").each(function(){var j=d(this),h=j.data("pagetemplate-id"),g=j.find(".template-operations"),i=Confluence.Templates.Blueprints.Promoted.middot(),f=Confluence.Templates.Blueprints.Promoted.promoteTemplateLink({templatePromoted:_.contains(e,h)});if(!g.is(":empty")){g.prepend(i)}g.prepend(f);j.find(".promoted-template-link").tooltip({aria:true})})});d("#pagetemplates-table").on("click",".promoted-template-link",function(){var f=d(this),g=f.attr("data-promoted")==="true",e=f.parents("tr[data-pagetemplate-id]").data("pagetemplate-id");a(f,g,e);event.preventDefault()});var a=function(g,f,e){g.disable();AJS.trigger("analytics",{name:"blueprint.user.template."+(f?"unpromote":"promote"),data:{}});d.ajax({url:Confluence.getContextPath()+b+e+"?"+jQuery.param({spaceKey:c}),type:f?"DELETE":"PUT",contentType:"application/json"}).done(function(){g.attr("data-promoted",!f);g.text(f?AJS.I18n.getText("create.content.plugin.templates.promoted.name"):AJS.I18n.getText("create.content.plugin.templates.non.promoted.name"))}).fail(function(){AJS.log("Could not promote/demote template with id: "+e)}).always(function(){g.enable()})}});