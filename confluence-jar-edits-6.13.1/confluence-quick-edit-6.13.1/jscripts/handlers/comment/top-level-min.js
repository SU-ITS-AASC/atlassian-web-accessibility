define("confluence-quick-edit/handlers/comment/top-level",["ajs","jquery","confluence-quick-edit/handlers/shortcut","confluence-quick-edit/handlers/comment","window"],function(b,a,c,d,f){function h(a){d.preInitialise(a)}function i(b){a("#comments-section").one("click",".quick-comment-prompt",e.activateEventHandler);a("#rte-savebar").scrollWindowToElement();d.postInitialise(b)}function j(){b.Confluence.EditorLoader.resourcesLoaded()||(b.trigger("analytics",{name:"rte.quick-edit.top-comment.spinner"}),
a(".quick-comment-prompt").hide(),a(".quick-comment-loading-container").fadeIn().spin("medium"))}function k(b){b.preventDefault();f.location=a("#add-comment-rte").attr("href")}var l=b.DarkFeatures.isEnabled("editor.slow.comment.disable"),e={commentShortcut:c.createShortcut("m",".quick-comment-prompt"),activateEventHandler:function(c){c.preventDefault();d.proceedWithActivation().done(function(){var c=d.createSaveHandler(d.delegatingSaveCommentHandler,d.saveCommentErrorHandler),g=a("form[name=inlinecommentform]");
return b.Confluence.QuickEdit.activateEditor({preActivate:j,$container:g.closest(".quick-comment-container"),$form:g,preInitialise:h,saveHandler:c,cancelHandler:d.cancelHandler,postInitialise:i,plugins:b.Confluence.Editor._Profiles.createProfileForCommentEditor().plugins,additionalResources:["wrc!comment-editor"],timeoutResources:d.timeout}).fail(function(c){b.logError("activateEventHandler failed because of: "+c);"READ_ONLY"===c||l?(d.showLoadingEditorErrorMessage(c),a("#comments-section").one("click",
".quick-comment-prompt",e.activateEventHandler)):f.location=a("#add-comment-rte").attr("href")})}).fail(function(){a("#comments-section").one("click",".quick-comment-prompt",e.activateEventHandler)})},enable:function(){a("#comments-section").one("click",".quick-comment-prompt",e.activateEventHandler);a("#add-comment-rte").removeClass("full-load");this.commentShortcut.bind()},disable:function(){a("#comments-section").off("click",".quick-comment-prompt");this.commentShortcut.unbind()}};b.Confluence.QuickEdit.register(e);
return{bindCommentAreaFallbackHandler:function(){a("#comments-section").delegate(".quick-comment-prompt","click",k)},cancelComment:function(){b.log("'AJS.Confluence.QuickEdit.QuickComment.TopLevel.cancelComment' is deprecated in 5.7, consider using 'AJS.Confluence.QuickEdit.QuickComment.cancelComment' instead.");return b.Confluence.QuickEdit.QuickComment.cancelComment()}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment/top-level","AJS.Confluence.QuickEdit.QuickComment.TopLevel");