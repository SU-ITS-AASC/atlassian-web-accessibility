define("confluence-editor/editor/page-editor-ui","jquery confluence/templates ajs confluence/meta confluence/legacy window moment document confluence/api/constants confluence-editor/editor/page-editor-message confluence-editor/editor/page-editor-quit-dialog".split(" "),function(c,f,b,e,d,k,p,h,r,s,l){return function(){var a={},j=function(c,b){for(var b=b||a.buttons,d=0;d<b.length;d++)m(c,b[d])},m=function(a,b){if(b)if(a){b.removeAttr("aria-disabled");b.removeAttr("disabled");b.removeClass("disabled")}else{b.attr("aria-disabled",
"true");b.attr("disabled","disabled");b.addClass("disabled")}},n=function(a){return a.length&&a.attr("aria-disabled")!=="true"},g=function(){return e.get("new-page")},o=function(){var a="";g()||(a=b.I18n.getText("edit.name")+" - ");return a};a.spinner=c("#rte-spinner");var i;i=f.Editor.Page.saveButton({contentType:e.get("content-type"),sharedDraftsEnabled:e.getBoolean("shared-drafts"),isNewPage:g()});c("#rte-button-publish").replaceWith(i);i=c("#rte-button-publish");a.saveButton=i;a.overwriteButton=
c("#rte-button-overwrite");a.editButton=c("#rte-button-edit");a.previewButton=c("#rte-button-preview");a.cancelButton=c("#rte-button-cancel");a.versionCommentInput=c("#versionComment");a.watchPageCheckbox=c("#watchPage");a.watchPageToolbarGroup=c(".toolbar-group-watch-page");a.buttons=[a.saveButton,a.overwriteButton,a.editButton,a.previewButton,a.cancelButton];b.bind("editor-shared-drafts-published",function(){var b=/\(.+\)/g.exec(a.saveButton.data("tooltip"))[0];a.saveButton.text(f.Editor.Page.saveButtonText({contentType:e.get("content-type"),
sharedDraftsEnabled:e.getBoolean("shared-drafts"),isNewPage:g()})).attr("title",f.Editor.Page.saveButtonTitle({contentType:e.get("content-type"),sharedDraftsEnabled:e.getBoolean("shared-drafts"),isNewPage:g()})+b).tooltip({gravity:"s"})});a.setButtonsState=j;a.setButtonState=m;a.isButtonEnabled=n;a.registerFormButton=function(b,c){a[b]=c;a.buttons.push(c)};a.postingDatePicker=null;a.isFormEnabled=function(){for(var b=0;b<a.buttons.length;b++)if(n(a.buttons[b]))return true;return false};a.toggleSavebarBusy=
function(b){if(b){if(!a.isFormEnabled())return false;a.spinner.addClass("aui-icon-wait");j(false)}else{a.spinner.removeClass("aui-icon-wait");j(true)}return true};a.init=function(){function f(){c("#rte-ellipsis-menu").is(":visible")&&c("#rte-button-ellipsis").trigger("aui-button-invoke")}l.init();d.Editor.addSaveHandler(function(c){if(a.isButtonEnabled(a.saveButton)){a.toggleSavebarBusy(true);b.trigger("confluence.editor.on.save")}else{c.stopImmediatePropagation();c.preventDefault()}});b.trigger("rte.init.ui");
d.Editor.isNewPage()&&c("#content-title").focus().select();d.Editor.addCancelHandler(function(a){d.Editor.getNumConcurrentEditors()>1&&b.Confluence.Analytics.publish("rte.notification.concurrent-editing.cancel",{numEditors:d.Editor.getNumConcurrentEditors(),pageId:b.params.pageId,draftType:b.params.draftType});l.process(a)});e.get("content-type")==="comment"&&d.Editor.addSaveHandler(function(){if(b.Rte.Content.isEmpty()){b.Confluence.EditorNotification.notify("warning",b.I18n.getText("content.empty"));
a.toggleSavebarBusy(false);return false}});(e.get("content-type")==="comment"||e.get("content-type")==="template")&&d.Editor.addCancelHandler(function(c){if(a.isFormEnabled()&&d.Editor.hasContentChanged()&&!d.Editor.isEmpty()){var q=e.get("content-type")==="comment"?b.I18n.getText("unsaved.comment.lost"):b.I18n.getText("unsaved.template.lost");if(!k.confirm(q)){c.stopImmediatePropagation();return false}}});a.versionCommentInput.on("keypress",function(a){a.keyCode===13&&l.process(a)});d.Editor.addSaveHandler(function(){d.Editor.getNumConcurrentEditors()>
1&&b.Confluence.Analytics.publish("rte.notification.concurrent-editing.save",{numEditors:d.Editor.getNumConcurrentEditors(),pageId:b.params.pageId,draftType:b.params.draftType})});d.Editor.addSubmitHandler(function(a){return d.Editor.contentFormSubmit(a)});this.currentEditMode=this.MODE_RICHTEXT;a.editButton.click(function(c){var e=require("tinymce");if(a.isFormEnabled()){d.Editor.changeMode(d.Editor.MODE_RICHTEXT);setTimeout(function(){b.Rte.getEditor().focus();e.isGecko&&d.Editor.bookmark&&b.Rte.getEditor().selection.moveToBookmark(d.Editor.bookmark)},
0);a.cancelButton.enable()}c.preventDefault()});a.previewButton.click(function(b){var c=require("tinymce");if(a.isFormEnabled()&&d.Editor.currentEditMode!==d.Editor.MODE_PREVIEW){f();j(false);a.spinner.addClass("aui-icon-wait");if(c.isGecko&&!d.Editor.bookmark)d.Editor.bookmark=c.activeEditor.selection.getBookmark();d.Editor.changeMode(d.Editor.MODE_PREVIEW,{errorCallback:function(){j(true);a.spinner.removeClass("aui-icon-wait")}});e.get("content-type")==="comment"||e.get("content-type")==="template"?
a.cancelButton.disable():a.cancelButton.enable()}b.preventDefault()});c("#rte-button-labels").bind("updateLabel",function(){var a=+e.get("num-labels")||0,d=b.I18n.getText("editor.labels.zero");a===1?d=b.I18n.getText("editor.labels.singular",a):a>1&&(d=b.I18n.getText("editor.labels.plural",a));c("#rte-button-labels").attr("data-tooltip",d)});c("#draft-status-lozenge").length&&c("#draft-status-lozenge").tooltip();var g=c("#PostingDate");if(g.length){g.attr("max",p().format("YYYY-MM-DD"));a.postingDatePicker=
g.datePicker({overrideBrowserDefault:true});a.postingDatePicker.hide()}c("#wysiwygTextarea_parent .mceProgress, #wysiwygTextarea_parent .mceBlocker").on("click",function(){b.Rte.getEditor().focus()});c(k).bind("render-content-loaded",function(b,e){var f=c("#previewArea iframe");if(f.contents().find("body")[0]==e){d.Editor.previewFrameOnload(e,f);[a.saveButton,a.overwriteButton,a.editButton,a.previewButton].forEach(function(a){m(true,a)});f.focus();k.focus();c(h).trigger("iframeAppended",f)}});if(e.get("heartbeat")){d.Editor.heartbeat();
d.Editor.heartbeatType.normal();b.bind("rte-destroyed",d.Editor.heartbeatType.cleanup)}b.bind("watchpage.pageoperation",function(){a.toggleWatchPage(false)});b.bind("unwatchpage.pageoperation",function(){a.toggleWatchPage(true)});if(e.get("new-page")&&e.get("form-name")==="inlinecommentform")h.title=b.I18n.getText("edit.name")+h.title;var i=h.title;if(e.get("new-page")&&c.trim(c("input#content-title").val()))h.title=o()+c("input#content-title").val()+" - "+e.get("space-name")+" - "+e.get("site-title");
c("input#content-title").on("change input",function(){if(e.get("content-type")!=="template"){var a=o();h.title=c.trim(this.value)?a+this.value+" - "+e.get("space-name")+" - "+e.get("site-title"):i}});c("body",c("#wysiwygTextarea_ifr").contents()).click(f);b.trigger("init.rte-control")};a.toggleWatchPage=function(b){if(b&&e.get("content-type")==="comment"){a.watchPageToolbarGroup.show();if(a.watchPageCheckbox.length)a.watchPageCheckbox[0].checked=false}else a.watchPageToolbarGroup.hide()};return a}});
require("confluence/module-exporter").safeRequire("confluence-editor/editor/page-editor-ui",function(c){var f=require("confluence/legacy");require("ajs").bind("init.rte",function(){var b=c();f.Editor.UI=b;b.init()})});