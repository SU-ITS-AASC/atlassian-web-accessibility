!function(){var e=function(e){this.$=e;var n=this.$,t={},i={},a=function(e,t,i,a,o){if(null!=t&&null!=t||(t=!l(e)),null!=i&&null!=i||(i=0),!u(e,t)){var c=n("#children"+e);if(r(c)){var d=n("#plusminus"+e);1==t?d.removeClass("aui-iconfont-chevron-right").addClass("aui-iconfont-chevron-down").attr("aria-expanded","true"):d.removeClass("aui-iconfont-chevron-down").addClass("aui-iconfont-chevron-right").attr("aria-expanded","false"),1==t?0==o?c.slideDown(300):(c.removeClass("plugin-pagetree-hide-children"),c.animate({opacity:1})):0==o?c.slideUp(300):c.animate({opacity:0},{complete:function(){c.addClass("plugin-pagetree-hide-children")}}),a&&g(e)}else m(e,new Array,i,"",a,o)}a&&g(e)},r=function(e){return e.children("ul[id]").length>0},l=function(e){var t=n("#plusminus"+e);return t.length>0&&(t.hasClass("icon-minus")||t.hasClass("aui-iconfont-chevron-down"))},u=function(e,n){return l(e)==n},o=function(e,n,t){d(e,!0,n,t)},c=function(e,n,t){d(e,!1,n,t)},d=function(e,t,i,r){f(e);var l=n("#"+e).find("div.plugin_pagetree_children_container");l.each(function(e){var n=s(this.id);a(n,t,999,e==l.length-1,r)}),i.preventDefault(),i.stopPropagation()},s=function(e){return e&&null!=e?-1!=e.indexOf("plusminus")?e.substring("plusminus".length):-1!=e.indexOf("children")?e.substring("children".length):null:null},p=function(e){return e&&null!=e?h(e)[1]:null},h=function(e){return e&&null!=e?e.split("-"):null},f=function(e){var t=p(e);n("div.plugin_pagetree").each(function(e){e==t&&(n(this).find("span.plugin_pagetree_status").removeClass("hidden"),n(this).find("div.plugin_pagetree_expandcollapse").addClass("hidden"))})},g=function(e){var t=p(e);n("div.plugin_pagetree").each(function(e){e==t&&(n(this).find("span.plugin_pagetree_status").addClass("hidden"),n(this).find("div.plugin_pagetree_expandcollapse").removeClass("hidden"))})},v=function(e,i,a,r,l,u,o){var c=t[e];return c+="Orphan"==i?"&hasRoot=false&spaceKey="+l:"&hasRoot=true&pageId="+i,c+="&treeId="+e+"&startDepth="+r+"&mobile="+o,n.each(a,function(){c+="&ancestors="+this}),c+="&treePageId="+u,0==o&&(c=(AJS.params.serverUrl||"")+c),c},_=function(e){var n=e.children("fieldset"),t=new Object;return n.length>0&&n.children("input").each(function(){t[this.name]=this.value}),t},m=function(e,t,r,l,u,o,c){var d=e,s=u,p=h(e),f=p[0],m=p[1],P=n("#children"+e),w=_(function(e){var t=e,i=null;return n("div.plugin_pagetree").each(function(e){e==t&&(i=n(this))}),i}(m)),x=!1;function y(){P.find(".plugin_pagetree_children_loading_wrapper .spinner").spin("small")}P.append(Confluence.Templates.Pagetree.Macro.loadingIndicator()),c?setTimeout(function(){x||y()},250):y(),n.ajax({type:"GET",url:v(m,f,t,r,l,w.treePageId,o),dataType:"text",success:function(e){var t,r;t=e,(r=n(document.createElement("div"))).html(t),r.find("ul[id^='child_ul']").length?(P.html(e),x=!0,P.children().length&&P.hasClass("hidden")&&P.removeClass("hidden"),function(e,t){n("a.plugin_pagetree_childtoggle",e).each(function(){var e=n(this);e.attr("href","#").bind("click",function(n){var i=e.parent().parent().children("div.plugin_pagetree_children_container").attr("id").substring(8);a(i,null,null,null,t),n.preventDefault(),n.stopPropagation()})})}(P,o),n("#plusminus"+d).addClass("aui-iconfont-chevron-down").removeClass("aui-iconfont-chevron-right").attr("aria-expanded","true"),n("#childrenspan"+i[parseInt(m)]+"-"+m).addClass("plugin_pagetree_current"),s&&g(d),C(P),AJS.PageGadget&&AJS.PageGadget.contentsUpdated&&AJS.PageGadget.contentsUpdated()):window.location=w.loginUrl,AJS.trigger("pagetree-children-loaded")},error:function(e){"403"==e.status?P.text(w["i18n-pagetree.error.permission"]):P.text(w["i18n-pagetree.error.general"])}})},C=function(e){n("div.plugin_pagetree_children_container:empty",e).addClass("hidden")},P=function(e,a){var r=_(e),l="true"==r.noRoot,u=l?"Orphan-"+a:r.rootPageId+"-"+a,d="true"==r.mobile;t[a]=r.treeRequestId,i[a]=0==d?AJS.params.pageId:n("div.content-container").parent().attr("data-content-id"),e.children("fieldset").each(function(){var e=n(this);e.children("input[treeId]").attr("value",a),e.children("input[rootPage]").attr("value",u)}),l?(e.find("div.plugin_pagetree_children").attr("id","childrenOrphan-"+a),e.find("a.plugin_pagetree_expandall").click(function(e){return o("childrenOrphan-"+a,e,d),!1}),e.find("a.plugin_pagetree_collapseall").click(function(e){return c("childrenOrphan-"+a,e,d),!1})):(e.find("div.plugin_pagetree_children").attr("id","children"+u),e.find("a.plugin_pagetree_expandall").click(function(e){return o("children"+u,e,d),!1}),e.find("a.plugin_pagetree_collapseall").click(function(e){return c("children"+u,e,d),!1}));var s=function(e){var n=e.children("fieldset"),t=new Array;if(n.length>0){var i=n.children("fieldset");i.length>0&&i.children("input").each(function(){t.push(this.value)})}return t}(e);m(u,s,r.startDepth,r.spaceKey,"",d,!0)};this.initPageTrees=function(){n("div.plugin_pagetree").each(function(e){P(n(this),e)}),w()};var w=function(){var e=self.placeFocus;e&&(self.placeFocus=function(){var t=n("form[name='pagetreesearchform']");t.attr("name","inlinecommentform"),e(),t.attr("name","pagetreesearchform")})};n(".open-flyout-to-search").bind("click",function(e){n(".fly-out-open").length?setTimeout(function(){ConfluenceMobile.flyout.hide()},400):setTimeout(function(){ConfluenceMobile.flyout.show()},400),e.stopPropagation(),e.preventDefault()})};Confluence=Confluence||{},Confluence.Plugins=Confluence.Plugins||{},Confluence.Plugins.PagetreeMacro={bind:function(n){new e(n).initPageTrees()}}}();