require(["ajs"],function(e){e.toInit(function(e){function t(t){return e(t).data("precedenceLevel")}function n(e,n){return n===t(e)}function r(i,o,c){if(0===i.length)return e();var a,u,s=i.map(t).reduce(function(e,t){return Math.min(e,t)});n(i[0],s)||i.unshift((a=s,(u=e({})).data("precedenceLevel",a),u));var l=o.createTocLevelContainer(),d={subElements:[],currentItem:void 0,outline:void 0,flush:function(){this.subElements.length>0&&this.currentItem&&(r(this.subElements,o,this.outline).appendTo(this.currentItem),this.subElements=[])},add:function(e){this.subElements.push(e)},resetItem:function(e){return this.outline=(c||[]).slice(0),this.outline.push(e),this.currentItem=o.createTocItemContainer(),this.currentItem.appendTo(l),this.currentItem}},f=0;return i.forEach(function(t){n(t,s)?(f++,d.flush(),d.resetItem(f),t.textContent?function(t,n){var r=t.id.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\\\$&");return e(Confluence.Plugins.TableOfContents.Client.tocItemBody({outline:n,linkHref:"#"+t.id,focusLink:'$("#'+r+'").focus();',linkText:t.textContent}))}(t,d.outline.join(".")).appendTo(d.currentItem):d.currentItem.addClass("toc-empty-item")):d.add(t)}),d.flush(),0===c.length&&o.decorateToc&&o.decorateToc(l),l}function i(t,n){var i=n.headerelements,o=i.split(","),c=function(t){var n,r;return t.includeheaderregex&&(n=new RegExp(t.includeheaderregex)),t.excludeheaderregex&&(r=new RegExp(t.excludeheaderregex)),function(){var t=e(this).text();return!(n&&!n.test(t)||r&&r.test(t))}}(n);return r(e("#main-content").find(i).filter(c).each(function(){var t,n;e(this).attr("tabindex","-1"),t=this,n=o.indexOf(this.nodeName),e(t).data("precedenceLevel",n)}).toArray(),t,[])}e(".client-side-toc-macro").each(function(){var t,n=e(this),r=n.data()||{};t="flat"===r.structure?function(t){return{createTocLevelContainer:function(){return this.createTocItemContainer()},createTocItemContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer({cssClass:"toc-item-container"}))},decorateToc:function(n){function r(r,i){var o=r in t?t[r]:i;o&&e(Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator({separator:o})).appendTo(n)}r("preseparator","[ "),e(n).find("span.toc-item-body").each(function(t,i){t>0&&r("midseparator"," ] [ "),e(i).appendTo(n)}),r("postseparator"," ]"),e(n).find(".toc-item-container").remove()}}}(r):function(t){return{createTocLevelContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer({cssliststyle:t.cssliststyle,csslistindent:t.csslistindent}))},createTocItemContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer())}}}(r),!0!==r.numberedoutline&&n.addClass("hidden-outline"),n.html(i(t,r))})})});