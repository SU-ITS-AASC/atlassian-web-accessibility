define("confluence-editor/utils/tinymce-macro-utils","tinymce ajs confluence/legacy confluence-editor/editor/page-editor-message jquery confluence/message-controller".split(" "),function(i,e,l,n,f,q){var o,p=function(a,c){var d;if(a.macro&&a.contentId)d={type:"POST",url:e.contextPath()+"/rest/tinymce/1/macro/placeholder",contentType:"application/json; charset=utf-8",data:f.toJSON(a),dataType:"text"};else if(a.url&&a.type)d=a;else throw Error("illegal argument received: "+a);var b=f.Deferred(),g=e.Rte.getEditor(),
j,m;if(!c){m="macro-"+(new Date).getTime();j=g.dom.create("span",{id:m});g.selection.setNode(j);c=j=g.dom.select("#"+m)[0];b.fail(function(){f(j).remove()})}f.extend(d,{timeout:o.DEFAULT_INSERT_MACRO_TIMEOUT});e.debug("Insert macro timeout = "+d.timeout);l.Editor.UI.setButtonsState(false);f.ajax(d).done(function(h){h[0]!=="<"&&(h=document.createTextNode(h));if(!c||!c.parentNode){e.logError("The node to be replaced has been already deleted from the document");b.rejectWith(this,arguments)}else i.confluence.NodeUtils.updateNode(c,
h).done(function(a){b.resolve(a,h)}).fail(b.reject)}).fail(function(h,a,c){e.logError("Macro placeholder request failed "+a+": '"+c+"'");"timeout"===a?n.handleMessage("macro-placeholder-error",{type:"error",message:e.I18n.getText("macro.placeholder.timeout")}):n.handleMessage("macro-placeholder-error",{type:"error",message:q.parseError(h,e.I18n.getText("macro.placeholder.error"))});b.rejectWith(this,arguments)});b.done(function(a,c){l.Editor.UI.setButtonsState(true);i.confluence.macrobrowser.isMacroWithBody(a)&&
/P|H\d/.test(a.parentNode.nodeName)&&g.dom.split(a.parentNode,a);var b=i.confluence.macrobrowser,d=i.activeEditor,j=d.getDoc(),k=d.selection.getRng(true);if(b.isMacroWithBody(a)){!i.isIE&&f("p, pre",a).each(function(){this.childNodes.length===0&&this.appendChild(j.createElement("br"))});if(b=d.dom.select(".wysiwyg-macro-body",a)[0].firstChild){k.setStart(b,0);k.setEnd(b,0)}else e.debug("focusMacroNode: couldn't find anything to focus, cap'n!")}else{k.setStartAfter(a);k.setEndAfter(a)}d.selection.setRng(k);
g.nodeChanged();e.Rte.showElement(a);g.selection.onSetContent.dispatch(g.selection,{content:c,format:"html"});i.activeEditor.undoManager.add();e.trigger("macro-browser.macro-inserted")}).fail(function(){l.Editor.UI.setButtonsState(true)});return b.promise()};return o={DEFAULT_INSERT_MACRO_TIMEOUT:e.Meta.get("macro-placeholder-timeout"),insertMacro:p,isInMacro:function(a){return(a.jquery?a:f(a)).closest(".wysiwyg-macro").length>0},updateMacro:function(a,c,d,b){a={contentId:l.getContentId(),macro:{name:d,
params:a,body:c?c:""}};return p(a,b)}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/utils/tinymce-macro-utils","tinymce.confluence.MacroUtils");