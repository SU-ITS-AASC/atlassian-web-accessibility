!function(){var e=function(e){this.$=e;var n=this.$,t={},i={},a=function(e,t,i,a,c){if(void 0!=t&&null!=t||(t=!l(e)),void 0!=i&&null!=i||(i=0),!o(e,t)){var u=n("#children"+e);if(r(u)){var d=n("#plusminus"+e);1==t?d.removeClass("aui-iconfont-chevron-right").addClass("aui-iconfont-chevron-down").attr("aria-expanded","true"):d.removeClass("aui-iconfont-chevron-down").addClass("aui-iconfont-chevron-right").attr("aria-expanded","false"),1==t?0==c?u.slideDown(300):(u.removeClass("plugin-pagetree-hide-children"),u.animate({opacity:1})):0==c?u.slideUp(300):u.animate({opacity:0},{complete:function(){u.addClass("plugin-pagetree-hide-children")}}),a&&g(e)}else _(e,new Array,i,"",a,c)}a&&g(e)},r=function(e){return e.children("ul[id]").length>0},l=function(e){var t=n("#plusminus"+e);return t.length>0&&(t.hasClass("icon-minus")||t.hasClass("aui-iconfont-chevron-down"))},o=function(e,n){return l(e)==n},c=function(e,n,t){d(e,!0,n,t)},u=function(e,n,t){d(e,!1,n,t)},d=function(e,t,i,r){f(e);var l=n("#"+e).find("div.plugin_pagetree_children_container");l.each(function(e){var n=s(this.id);a(n,t,999,e==l.length-1,r)}),i.preventDefault(),i.stopPropagation()},s=function(e){return e&&void 0!=e?-1!=e.indexOf("plusminus")?e.substring("plusminus".length):-1!=e.indexOf("children")?e.substring("children".length):null:null},p=function(e){return e&&void 0!=e?h(e)[1]:null},h=function(e){return e&&void 0!=e?e.split("-"):null},f=function(e){var t=p(e);n("div.plugin_pagetree").each(function(e){e==t&&(n(this).find("span.plugin_pagetree_status").removeClass("hidden"),n(this).find("div.plugin_pagetree_expandcollapse").addClass("hidden"))})},g=function(e){var t=p(e);n("div.plugin_pagetree").each(function(e){e==t&&(n(this).find("span.plugin_pagetree_status").addClass("hidden"),n(this).find("div.plugin_pagetree_expandcollapse").removeClass("hidden"))})},v=function(e){var n=e.children("fieldset"),t=new Object;return n.length>0&&n.children("input").each(function(){t[this.name]=this.value}),t},_=function(e,r,l,o,c,u,d){var s,p,f,_,C,P,w,x,y,b,I=e,A=c,O=h(e),T=O[0],k=O[1],D=n("#children"+e),J=v((s=k,p=null,n("div.plugin_pagetree").each(function(e){e==s&&(p=n(this))}),p)),S=!1;function U(){D.find(".plugin_pagetree_children_loading_wrapper .spinner").spin("small")}D.append(Confluence.Templates.Pagetree.Macro.loadingIndicator()),d?setTimeout(function(){S||U()},250):U(),n.ajax({type:"GET",url:(f=k,_=T,C=r,P=l,w=o,x=J.treePageId,y=u,b=t[f],b+="Orphan"==_?"&hasRoot=false&spaceKey="+w:"&hasRoot=true&pageId="+_,b+="&treeId="+f+"&startDepth="+P+"&mobile="+y,n.each(C,function(){b+="&ancestors="+this}),b+="&treePageId="+x,0==y&&(b=(AJS.params.serverUrl||"")+b),b),dataType:"text",success:function(e){var t,r,l;r=e,(l=n(document.createElement("div"))).html(r),l.find("ul[id^='child_ul']").length?(D.html(e),S=!0,D.children().length&&D.hasClass("hidden")&&D.removeClass("hidden"),t=u,n("a.plugin_pagetree_childtoggle",D).each(function(){var e=n(this);e.attr("href","#").bind("click",function(n){var i=e.parent().parent().children("div.plugin_pagetree_children_container").attr("id").substring(8);a(i,null,null,null,t),n.preventDefault(),n.stopPropagation()})}),n("#plusminus"+I).addClass("aui-iconfont-chevron-down").removeClass("aui-iconfont-chevron-right").attr("aria-expanded","true"),n("#childrenspan"+i[parseInt(k)]+"-"+k).addClass("plugin_pagetree_current"),A&&g(I),m(D),AJS.PageGadget&&AJS.PageGadget.contentsUpdated&&AJS.PageGadget.contentsUpdated()):window.location=J.loginUrl,AJS.trigger("pagetree-children-loaded")},error:function(e){"403"==e.status?D.text(J["i18n-pagetree.error.permission"]):D.text(J["i18n-pagetree.error.general"])}})},m=function(e){n("div.plugin_pagetree_children_container:empty",e).addClass("hidden")},C=function(e,a){var r=v(e),l="true"==r.noRoot,o=l?"Orphan-"+a:r.rootPageId+"-"+a,d="true"==r.mobile;t[a]=r.treeRequestId,i[a]=0==d?AJS.params.pageId:n("div.content-container").parent().attr("data-content-id"),e.children("fieldset").each(function(){var e=n(this);e.children("input[treeId]").attr("value",a),e.children("input[rootPage]").attr("value",o)}),l?(e.find("div.plugin_pagetree_children").attr("id","childrenOrphan-"+a),e.find("a.plugin_pagetree_expandall").click(function(e){return c("childrenOrphan-"+a,e,d),!1}),e.find("a.plugin_pagetree_collapseall").click(function(e){return u("childrenOrphan-"+a,e,d),!1})):(e.find("div.plugin_pagetree_children").attr("id","children"+o),e.find("a.plugin_pagetree_expandall").click(function(e){return c("children"+o,e,d),!1}),e.find("a.plugin_pagetree_collapseall").click(function(e){return u("children"+o,e,d),!1}));var s=function(e){var n=e.children("fieldset"),t=new Array;if(n.length>0){var i=n.children("fieldset");i.length>0&&i.children("input").each(function(){t.push(this.value)})}return t}(e);_(o,s,r.startDepth,r.spaceKey,"",d,!0)};this.initPageTrees=function(){n("div.plugin_pagetree").each(function(e){C(n(this),e)}),P()};var P=function(){var e=self.placeFocus;e&&(self.placeFocus=function(){var t=n("form[name='pagetreesearchform']");t.attr("name","inlinecommentform"),e(),t.attr("name","pagetreesearchform")})};n(".open-flyout-to-search").bind("click",function(e){n(".fly-out-open").length?setTimeout(function(){ConfluenceMobile.flyout.hide()},400):setTimeout(function(){ConfluenceMobile.flyout.show()},400),e.stopPropagation(),e.preventDefault()})};Confluence=Confluence||{},Confluence.Plugins=Confluence.Plugins||{},Confluence.Plugins.PagetreeMacro={bind:function(n){new e(n).initPageTrees()}}}();