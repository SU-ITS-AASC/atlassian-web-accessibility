("undefined"===typeof window?global:window).__9d6bbe6056be3ba99a06a04900676ca7=function(){function f(a){return a&&a.__esModule?a:{"default":a}}function j(a,b,c){(0,e.default)(b).trigger(a,c);(0,e.default)(document).trigger(a,c);b.id&&(a=b.id+"_"+a,(0,e.default)(document).trigger(a,c))}var m={};"use strict";Object.defineProperty(m,"__esModule",{value:!0});var e=f(__700a145ba3db9966cc95664c892049f8),n;var h=__c1e961001275c079e48525ad3a48c8c2;if(h&&h.__esModule)n=h;else{var k={};if(null!=h)for(var l in h)Object.prototype.hasOwnProperty.call(h,
l)&&(k[l]=h[l]);k.default=h;n=k}var o=f(__320e4ec293ac29d49b959aa9d46df68f),r=f(__80eabeead1490f859f6a708858b1dc25);l=f(__0d34270c41fe2d547efed0ce03f668c0);var h=f(__15ac66f9a1559266d249b098cf180f35),k=f(__ce5d8a803e1fd58153b33f9bb2fe0bff),s=f(__40ea873dae0b909ba7e1b6d5b37fd259),t=f(__fa98b6b6842afadeca33f835f6fd852f),p=f(__8050ba61a386ff790f31b0634ce1c858),u=f(__b912ac75391ff799576d1dfdc1dc3c70),w=f(__28c84e7bb75f6c3b0ba124d57bd69571);f(__fa714f1b12d7502957e4e0b6196321bf);var q=f(__8ac1973494a53eee4a578e7b0d48a1b6),
v=f(__09339e7cdcdecdedab4ce02aa86100f2),g=o.default.View.extend({initialize:function(a){var b=this;b.options=e.default.extend(!0,b._getDefaultOptions(a),a);b.id=this.options.id;b._event=u.default;b.classNames=r.default;b.dataKeys=s.default;this.$table=(0,e.default)(a.el).addClass(this.classNames.RESTFUL_TABLE).addClass(this.classNames.ALLOW_HOVER).addClass("aui").addClass(b.classNames.LOADING);this.$table.wrapAll("<form class='aui' action='#' />");this.$thead=(0,e.default)("<thead/>");this.$theadRow=
(0,e.default)("<tr />").appendTo(this.$thead);this.$tbody=(0,e.default)("<tbody/>");if(!this.$table.length)throw Error("RestfulTable: Init failed! The table you have specified ["+this.$table.selector+"] cannot be found.");if(!this.options.columns)throw Error("RestfulTable: Init failed! You haven't provided any columns to render.");this.showGlobalLoading();this.options.columns.forEach(function(a){var d=e.default.isFunction(a.header)?a.header():a.header;"undefined"===typeof d&&(n.warn("You have not specified [header] for column ["+
a.id+"]. Using id for now..."),d=a.id);b.$theadRow.append("<th>"+d+"</th>")});b.$theadRow.append("<th></th><th></th>");this._models=this._createCollection();this._rowClass=this.options.views.row;this.editRows=[];this.$table.closest("form").submit(function(a){b.focusedRow&&b.focusedRow.trigger(b._event.SAVE);a.preventDefault()});this.options.allowReorder&&(this.$theadRow.prepend("<th />"),this.$tbody.sortable({handle:"."+this.classNames.DRAG_HANDLE,helper:function(a,d){var i=(0,e.default)("<div/>").attr("class",
d.attr("class")).addClass(b.classNames.MOVEABLE);d.children().each(function(){var a=(0,e.default)(this),b=parseInt(0+a.css("border-left-width"),10),c=parseInt(0+a.css("border-right-width"),10),b=a[0].clientWidth+b+c;i.append((0,e.default)("<div/>").html(a.html()).attr("class",a.attr("class")).width(b))});i=(0,e.default)("<div class='aui-restfultable-readonly'/>").append(i);i.css({left:d.offset().left});i.appendTo(document.body);return i},start:function(a,d){var i=d.helper[0].clientHeight,f=d.placeholder.find("td");
d.item.addClass(b.classNames.MOVEABLE).children().each(function(a){(0,e.default)(this).width(f.eq(a).width())});var g='<td colspan="'+b.getColumnCount()+'">&nbsp;</td>';d.placeholder.html(g).css({height:i,visibility:"visible"});b.getRowFromElement(d.item[0]).trigger(b._event.MODAL)},stop:function(a,d){if((0,e.default)(d.item[0]).is(":visible"))d.item.removeClass(b.classNames.MOVEABLE).children().attr("style",""),d.placeholder.removeClass(b.classNames.ROW),b.getRowFromElement(d.item[0]).trigger(b._event.MODELESS)},
update:function(a,d){var e={row:b.getRowFromElement(d.item[0]),item:d.item,nextItem:d.item.next(),prevItem:d.item.prev()};b.move(e)},axis:"y",delay:0,containment:"document",cursor:"move",scroll:!0,zIndex:8E3}),this.$tbody.bind("selectstart mousedown",function(a){return!(0,e.default)(a.target).is("."+b.classNames.DRAG_HANDLE)}));!1!==this.options.allowCreate&&(this._createRow=(new this.options.views.editRow({columns:this.options.columns,isCreateRow:!0,model:this.options.model.extend({url:function(){return b.options.resources.self}}),
cancelAccessKey:this.options.cancelAccessKey,submitAccessKey:this.options.submitAccessKey,allowReorder:this.options.allowReorder,fieldFocusSelector:this.options.fieldFocusSelector})).bind(this._event.CREATED,function(a){b.options.addPosition==void 0&&b.options.createPosition==="bottom"||b.options.addPosition==="bottom"?b.addRow(a):b.addRow(a,0)}).bind(this._event.VALIDATION_ERROR,function(){this.trigger(b._event.FOCUS)}).render({errors:{},values:{}}),this.$create=(0,e.default)('<tbody class="'+this.classNames.CREATE+
'" />').append(this._createRow.el),this._applyFocusCoordinator(this._createRow),this._createRow.trigger(this._event.FOCUS));this._models.bind("remove",function(a){b.getRows().forEach(function(d){if(d.model===a){d.hasFocus()&&b._createRow&&b._createRow.trigger(b._event.FOCUS);b.removeRow(d)}})});this.fetchInitialResources()},fetchInitialResources:function(){var a=this;e.default.isFunction(this.options.resources.all)?this.options.resources.all(function(b){a.populate(b)}):e.default.get(this.options.resources.all,
function(b){a.populate(b)})},move:function(a){var b=this,c=function(a){return a.length?{after:b.getRowFromElement(a).model.url()}:{position:"First"}};a.row&&(c=b.options.reverseOrder?c(a.nextItem):c(a.prevItem),e.default.ajax({url:a.row.model.url()+"/move",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(c),complete:function(){a.row.hideLoading()},success:function(a){j(b._event.REORDER_SUCCESS,b,[a])},error:function(a){var c=e.default.parseJSON(a.responseText||a.data);
j(b._event.SERVER_ERROR,b,[c,a,this])}}),a.row.showLoading())},_createCollection:function(){var a=this;return new (this.options.Collection.extend({sort:function(b){b||(b={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.tableRows=a.getRows();this.models=this.sortBy(this.comparator,this);this.tableRows=void 0;b.silent||this.trigger("refresh",this,b);return this},remove:function(b,c){this.tableRows=a.getRows();o.default.Collection.prototype.remove.apply(this,arguments);
this.tableRows=void 0;return this}}))([],{comparator:function(b){var c;(this&&void 0!==this.tableRows?this.tableRows:a.getRows()).some(function(a,e){if(a.model.id===b.id)return c=e,!0});return c}})},populate:function(a){this.options.reverseOrder&&a.reverse();this.hideGlobalLoading();a&&a.length?(this._models.reset([],{silent:!0}),this.renderRows(a),this.isEmpty()&&this.showNoEntriesMsg()):this.showNoEntriesMsg();this.$table.append(this.$thead);"bottom"===this.options.createPosition?this.$table.append(this.$tbody).append(this.$create):
this.$table.append(this.$create).append(this.$tbody);this.$table.removeClass(this.classNames.LOADING).trigger(this._event.INITIALIZED,[this]);j(this._event.INITIALIZED,this,[this]);this.options.autoFocus&&this.$table.find(":input:text:first").focus()},showGlobalLoading:function(){this.$loading||(this.$loading=(0,e.default)('<div class="aui-restfultable-init">'+(0,v.default)()+'<span class="aui-restfultable-loading">'+this.options.loadingMsg+"</span></div>"));this.$loading.is(":visible")||this.$loading.insertAfter(this.$table);
return this},hideGlobalLoading:function(){this.$loading&&this.$loading.remove();return this},addRow:function(a,b){var c,d;if(!a.id)throw Error("RestfulTable.addRow: to add a row values object must contain an id. Maybe you are not returning it from your restend point?Recieved:"+JSON.stringify(a));d=new this.options.model(a);c=this._renderRow(d,b);this._models.add(d);this.removeNoEntriesMsg();j(this._event.ROW_ADDED,this,[c,this]);return this},removeRow:function(a){this._models.remove(a.model);a.remove();
this.isEmpty()&&this.showNoEntriesMsg();j(this._event.ROW_REMOVED,this,[a,this])},isEmpty:function(){return 0===this._models.length},getModels:function(){return this._models},getTable:function(){return this.$table},getTableBody:function(){return this.$tbody},getCreateRow:function(){return this._createRow},getColumnCount:function(){var a=2;this.allowReorder&&++a;return this.options.columns.length+a},getRowFromElement:function(a){return(0,e.default)(a).data(this.dataKeys.ROW_VIEW)},showNoEntriesMsg:function(){this.$noEntries&&
this.$noEntries.remove();this.$noEntries=(0,e.default)("<tr>").addClass(this.classNames.NO_ENTRIES).append((0,e.default)("<td>").attr("colspan",this.getColumnCount()).text(this.options.noEntriesMsg)).appendTo(this.$tbody);return this},removeNoEntriesMsg:function(){this.$noEntries&&0<this._models.length&&this.$noEntries.remove();return this},getRows:function(){var a=this,b=[];this.$tbody.find("."+this.classNames.READ_ONLY).each(function(){var c=(0,e.default)(this).data(a.dataKeys.ROW_VIEW);c&&b.push(c)});
return b},_renderRow:function(a,b){var c=this,d=this.$tbody.find("."+this.classNames.READ_ONLY),e,f;f=new this._rowClass({model:a,columns:this.options.columns,allowEdit:this.options.allowEdit,allowDelete:this.options.allowDelete,allowReorder:this.options.allowReorder,deleteConfirmation:this.options.deleteConfirmation});this.removeNoEntriesMsg();f.bind(this._event.ROW_EDIT,function(a){j(this._event.EDIT_ROW,{},[this,c]);c.edit(this,a)});e=f.render().$el;-1!==b&&("number"===typeof b&&0!==d.length?e.insertBefore(d[b]):
this.$tbody.append(e));e.data(this.dataKeys.ROW_VIEW,f);f.bind(this._event.MODAL,function(){c.$table.removeClass(c.classNames.ALLOW_HOVER);c.$tbody.sortable("disable");c.getRows().forEach(function(a){c.isRowBeingEdited(a)||a.delegateEvents({})})});f.bind(this._event.MODELESS,function(){c.$table.addClass(c.classNames.ALLOW_HOVER);c.$tbody.sortable("enable");c.getRows().forEach(function(a){c.isRowBeingEdited(a)||a.delegateEvents()})});this._applyFocusCoordinator(f);this.trigger(this._event.ROW_INITIALIZED,
f);return f},isRowBeingEdited:function(a){var b=!1;this.editRows.some(function(c){if(c.el===a.el)return b=!0});return b},_applyFocusCoordinator:function(a){var b=this;a.hasFocusBound||(a.hasFocusBound=!0,a.bind(this._event.FOCUS,function(){b.focusedRow&&b.focusedRow!==a&&b.focusedRow.trigger(b._event.BLUR);b.focusedRow=a;a instanceof q.default&&b._createRow&&b._createRow.enable()}));return this},_removeEditRow:function(a){a=e.default.inArray(a,this.editRows);this.editRows.splice(a,1);return this},
_shiftFocusAfterEdit:function(){0<this.editRows.length?this.editRows[this.editRows.length-1].trigger(this._event.FOCUS):this._createRow&&this._createRow.trigger(this._event.FOCUS);return this},_saveEditRowOnBlur:function(){return 1>=this.editRows.length},dismissEditRows:function(){this.editRows.forEach(function(a){a.hasUpdates()||a.trigger(this._event.FINISHED_EDITING)},this)},edit:function(a,b){var c=this,d=new this.options.views.editRow({el:a.el,columns:this.options.columns,isUpdateMode:!0,allowReorder:this.options.allowReorder,
fieldFocusSelector:this.options.fieldFocusSelector,model:a.model,cancelAccessKey:this.options.cancelAccessKey,submitAccessKey:this.options.submitAccessKey}),e=a.model.toJSON();e.update=!0;d.render({errors:{},update:!0,values:e}).bind(c._event.UPDATED,function(b,d){c._removeEditRow(this);this.unbind();a.render().delegateEvents();a.trigger(c._event.UPDATED);!1!==d&&c._shiftFocusAfterEdit()}).bind(c._event.VALIDATION_ERROR,function(){this.trigger(c._event.FOCUS)}).bind(c._event.FINISHED_EDITING,function(){c._removeEditRow(this);
a.render().delegateEvents();this.unbind()}).bind(c._event.CANCEL,function(){c._removeEditRow(this);this.unbind();a.render().delegateEvents();c._shiftFocusAfterEdit()}).bind(c._event.BLUR,function(){c.dismissEditRows();c._saveEditRowOnBlur()&&this.trigger(c._event.SAVE,!1)});this._applyFocusCoordinator(d);d.trigger(c._event.FOCUS,b);c._createRow&&c._createRow.disable();this.editRows.push(d);return d},renderRows:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],c=this._models.comparator,
d=[];this._models.comparator=void 0;b=b.map(function(b){b=new a.options.model(b);d.push(a._renderRow(b,-1).el);return b});this._models.add(b,{silent:!0});this._models.comparator=c;this.removeNoEntriesMsg();this.$tbody.append(d);return this},_getDefaultOptions:function(a){return{model:a.model||p.default,allowEdit:!0,views:{editRow:t.default,row:q.default},Collection:o.default.Collection.extend({url:a.resources.self,model:a.model||p.default}),allowReorder:!1,fieldFocusSelector:function(a){return":input[name="+
a+"], #"+a},loadingMsg:a.loadingMsg||AJS.I18n.getText("aui.words.loading")}}});g.ClassNames=r.default;g.CustomCreateView=l.default;g.CustomEditView=h.default;g.CustomReadView=k.default;g.DataKeys=s.default;g.EditRow=t.default;g.EntryModel=p.default;g.Events=u.default;g.Row=q.default;g.Throbber=v.default;(0,w.default)("RestfulTable",g);m.default=g;return m=m["default"]}.call(this);