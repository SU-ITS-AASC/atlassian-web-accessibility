AJS.toInit(function(b){var a=AJS.Data.get("context-path");var c=b("#edit-in-word, #edit-in-word-pathauth, a.office-editable, a.office-editable-pathauth");c.click(function(h){h.preventDefault();var g=b(this);var f=g.attr("data-use-path-auth");if(typeof(f)=="undefined"){f=(g.attr("id")=="edit-in-word-pathauth"||g.hasClass("office-editable-pathauth"))}else{f=(f==="true")}var i=g.attr("href");var d=g.attr("data-prog-id");if(typeof(d)=="undefined"){d=getProgID(i)}return doEditInOffice(a,i,d,f)})});function getProgID(b){var a=b.substring(b.lastIndexOf(".")+1);switch(a){case"ppt":case"pptx":case"ppsx":case"pot":case"potx":case"pptm":return"PowerPoint.Show";case"doc":case"docx":case"dot":case"dotx":return"Word.Document";case"xls":case"xlt":case"xlsx":case"xlst":case"xlsm":case"xltx":return"Excel.Sheet";default:return""}}function filterPath(b,c,a){AJS.$.ajax({url:contextPath+"/rest/office/1.0/authtoken",success:function(g){if(g.token){var d=b.split("/");var f="";for(var e=0;e<d.length-1;e++){if(d[e].length){f=f+"/"+d[e]}}f=f+"/ocauth/"+g.token+"/"+d[d.length-1];c(f)}else{a("Unable to retrieve a temporary auth token. Check your server logs.")}},error:function(d,f,e){a("Ajax error retrieving token: "+f+", error from server: "+e)},statusCode:{403:function(){a("The current configuration requires you to be logged in to use the Office Connector.")}}})}function getCookie(b){var f=document.cookie.split(";");var c="";var d="";var e="";for(var a=0;a<f.length;a++){c=f[a].split("=");d=c[0].replace(/^\s+|\s+$/g,"");if(d==b){if(c.length>1){e=unescape(c[1].replace(/^\s+|\s+$/g,""))}return e}c=null;d=""}return null}function getBaseUrl(){return location.protocol+"//"+location.host}function handleTokenError(a){alert(a)}function doEditInOffice(b,h,c,f){var e=getBaseUrl();var g=typeof window.InstallTrigger!=="undefined";if(typeof window.ActiveXObject!=="undefined"||"ActiveXObject" in window){var a;try{a=new ActiveXObject("SharePoint.OpenDocuments.1")}catch(d){window.alert("Unable to create an ActiveX object to open the document. This is most likely because of the security settings for your browser.");return false}if(a){filterPath(h,function(i){a.EditDocument(e+i,c)},handleTokenError);return false}else{window.alert("Cannot instantiate the required ActiveX control to open the document. This is most likely because you do not have Office installed or you have an older version of Office.");return false}}else{if(!g){editWithMicrosoftOffice(f,h)}else{if(window.URLLauncher){if(isMicrosoftOffice(h)){editWithMicrosoftOffice(f,h)}else{editWithNonMicrosoftOffice(f,h)}}else{if(window.confirm("A plugin is required to use this feature. Would you like to download it?")){InstallTrigger.install({"WebDAV Launcher":"https://update.atlassian.com/office-connector/URLLauncher/latest/webdavloader.xpi"})}}}}return false}function editWithMicrosoftOffice(a,b){filterPath(b,launchWithOFE,handleTokenError)}function isMicrosoftOffice(a){var b=a.substring(a.lastIndexOf(".")+1).toLowerCase();return new URLLauncher().isMicrosoftOfficeInstalled(b)}function launchWithFF(c){try{var a=new URLLauncher();if(a.open2){var e=new RegExp(contextPath+"/plugins/servlet/[^/]+/");var d=c.match(e);var b=c.substring(d[0].length);a.open2(encodeURI(d[0]),encodeURI(b))}else{a.open(c)}}catch(f){window.alert("Unable to open your Office file. Have you installed MS Office yet?. Read more detail at https://confluence.atlassian.com/display/DOC/Installing+the+Firefox+Add-On+for+the+Office+Connector")}}function editWithNonMicrosoftOffice(b,c){var a=navigator.appVersion.indexOf("Mac")!=-1;if(b&&!a){c=filterPath(c,launchWithFF,handleTokenError)}else{launchWithFF(c)}}function getMicrosoftProtocol(a){var b=a.substring(a.lastIndexOf(".")+1).toLowerCase();switch(b){case"ppt":case"pptx":case"ppsx":case"pot":case"potx":case"pptm":return"ms-powerpoint";case"doc":case"docx":case"dot":case"dotx":return"ms-word";case"xls":case"xlt":case"xlsx":case"xlst":case"xlsm":case"xltx":return"ms-excel";default:return""}}function launchWithOFE(a){try{var b=getMicrosoftProtocol(a)+":ofe|u|"+getBaseUrl()+a;window.location=b}catch(c){window.alert("Unable to open your Office file. Have you installed MS Office yet?. Read more detail at https://confluence.atlassian.com/display/DOC/Installing+the+Firefox+Add-On+for+the+Office+Connector")}}function enableEdit(a){a.style.cursor="pointer";a.style.backgroundColor="#cccccc";a.style.color=""}function disableEdit(a){a.style.cursor="";a.style.backgroundColor="#ffffff";a.style.color="#ffffff"}if(typeof define!=="undefined"){define("office-connector/edit-in-office",[],function(){return{getProgID:getProgID,doEditInOffice:doEditInOffice}})};