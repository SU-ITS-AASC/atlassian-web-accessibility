define("atlassian-tinymce/plugins/lists/editor_plugin_src",["tinymce","ajs","jquery"],function(d,o,D){function E(a,b){for(;a&&(8===a.nodeType||3===a.nodeType&&/^[ \t\n\r]*$/.test(a.nodeValue));)a=b(a);return a}function r(a){return E(a,function(a){return a.previousSibling})}function u(a){return E(a,function(a){return a.nextSibling})}function F(a,b,k){return a.dom.getParent(b,function(a){return-1!==d.inArray(k,a)})}function q(a){return a&&("OL"===a.tagName||"UL"===a.tagName)}function C(a,b){var d,c;
for(d=r(a.lastChild);q(d);)c=d,d=r(c.previousSibling);c&&(d=b.create("li",{style:v}),b.split(a,c),b.insertAfter(d,c),d.appendChild(c),d.appendChild(c),a=d.previousSibling);return a}function x(a,b,d){var c=r(a.previousSibling),a=c?w(c,a,b?c:!1,d):a;return G(a,b,d)}function G(a,b,d){var c=u(a.nextSibling);return c?w(a,c,b?c:!1,d):a}function w(a,b,d,c){var f=!!d;if(!a||!b)c=!1;else if("LI"===a.tagName&&"LI"===b.tagName)c="none"===b.style.listStyleType||H(b);else if(q(a)){if(!(c=a.tagName===b.tagName&&
a.className===b.className&&(f||a.style.listStyleType===b.style.listStyleType)))c=u(b.firstChild),f=r(b.lastChild),c=c&&f&&q(b)&&c===f&&(q(c)||"none"===c.style.listStyleType||H(c))}else c=c&&"P"===a.tagName&&"P"===b.tagName;if(c){c=r(a.lastChild);f=u(b.firstChild);for("P"===a.tagName&&a.appendChild(a.ownerDocument.createElement("br"));b.firstChild;)a.appendChild(b.firstChild);d&&(a.style.listStyleType=d.style.listStyleType);b.parentNode.removeChild(b);w(c,f,!1);return a}a&&("LI"===a.tagName&&q(b))&&
a.appendChild(b);return b}function H(a){var d=u(a.firstChild),a=r(a.lastChild);return d&&a&&d===a&&q(d)}function I(a,d){var k;d.is(a,"li,ol,ul")||(k=d.getParent(a,"li"))&&(a=k);return a}var v="list-style-type: none; background-image: none;",J="a,b,i,em,strong,u,span,s,sub,sup,code,br",y=d.each,s=d.dom.Event,z;return{init:function(a){function b(){var n=a.selection.getStart();return"LI"==n.tagName?n:a.dom.getParent(n,"li")}function k(a){if(a){var a=D(a),d=a.find("*"),e=d.filter(J);return d.length!==
e.length?!1:0===o.trim(a.text()).length&&1>=e.filter("br").length}return!1}function c(n){if(n&&(d.isGecko||d.isWebKit))for(var n=n.childNodes,b,e=n.length-1;0<=e;e--)b=n[e],3===b.nodeType&&!b.length&&a.dom.remove(b)}function f(a,c){if(c.keyCode===d.VK.BACKSPACE&&d.isWebKit){var e=b();if(e){var h=a.dom.getParent(e,"ol,ul"),f=a.selection.getRng();if(h&&h.firstChild===e&&(0===f.startOffset||1===f.startOffset&&""===f.startContainer.textContent)&&!a.selection.getContent().trim()&&f.startContainer.textContent===
e.textContent)return a.execCommand("Outdent",!1,e),a.undoManager.add(),s.cancel(c)}}}function j(a,b,e){e&&(1===e.nodeType&&a.dom.is(e,"li"))&&(b=e.parentNode,d.each(a.dom.select("li>ul,li>ol",b),function(d){a.dom.getAttrib(d.parentNode,"data-mce-style")||d.previousSibling||d.parentNode.insertBefore(a.dom.doc.createElement("br"),d)}))}function m(a,c){var e,h;if(b()&&(c.keyCode===d.VK.ENTER&&!c.shiftKey||c.keyCode===d.VK.BACKSPACE||c.keyCode===d.VK.DELETE)){e=a.selection.getRng(!0);h=e.endContainer;
if(3===h.nodeType){if(e.endOffset!==h.length)return;h=h.nextSibling}else if(1===h.nodeType)h=h.childNodes[e.endOffset];else return;if(h&&a.dom.is(h,"ul,ol"))if(d.isIE){var f=h,i=a.dom.doc.createTextNode(String.fromCharCode(160)),g=f.previousSibling;e=d.isIE6||d.isIE7||d.isIE8?e:a.getDoc().createRange();g&&3===g.nodeType&&g.nodeValue[g.length-1]==i.nodeValue?(e.setStart(g,g.length-1),e.setEnd(g,g.length-1)):(h.parentNode.insertBefore(i,f),e.setStartBefore(i),e.setEndBefore(i));e.collapse(!0);a.selection.setRng(e)}else h.parentNode.insertBefore(a.dom.create("br"),
h)}}function g(a){function f(d){var e=d.parentNode,b=e.previousSibling,h;c(e);e.childNodes[0]===d&&!a.dom.getAttrib(e,"data-mce-style")&&(a.selection.getStart().parentNode==d&&(h=a.selection.getRng(!0),h={startOffset:h.startOffset,startContainer:h.startContainer}),b?b.appendChild(d):(b=a.dom.create("li",{style:v}),b.appendChild(d),e.parentNode.insertBefore(b,e)),h&&a.selection.setCursorLocation(h.startContainer||d.firstChild,h.startOffset),k(e)&&a.dom.remove(e))}var e=b();if(e){var h=e.parentNode;
d.grep(a.dom.select("li>ul, li>ol",h),f);a.dom.is(h.parentNode,"li")&&f(h);e===h.lastChild&&(h.nextSibling&&a.dom.is(h.nextSibling,"ul, ol"))&&d.grep(a.dom.select("li>ul, li>ol",h.nextSibling),f)}}function l(a,d){if(46===d.keyCode&&!d.shiftKey){var e=b();if(e&&(0===e.childNodes.length||1===e.childNodes.length&&"BR"===e.firstChild.nodeName)){var c,f;if(c=e.nextSibling)c=a.dom.doc.createTreeWalker(c,NodeFilter.SHOW_TEXT,null,!1),c=c.nextNode(),f=a.getDoc().createRange(),f.setStart(c,0),f.setEnd(c,0),
a.selection.setRng(f),a.dom.remove(e),a.undoManager.add(),s.cancel(d)}}}var p="UNKNOWN";this.ed=a;a.addCommand("Indent",this.indent,this);a.addCommand("Outdent",this.outdent,this);a.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this);a.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this);a.addCommand("InsertInlineTaskList",function(){o.Rte.Support.inlineTasks()&&this.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},
placeholderText:o.I18n.getText("tinymce.confluence.placeholder.inline.tasks")})},this);a.addCommand("InsertInlineTaskListNoToggle",function(){o.Rte.Support.inlineTasks()&&this.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},placeholderText:o.I18n.getText("tinymce.confluence.placeholder.inline.tasks"),noToggle:!0})},this);a.onInit.add(function(){a.editorCommands.addCommands({outdent:function(){function d(b){return(b=e.getParent(b,e.isBlock))&&0<parseInt(a.dom.getStyle(b,
"margin-left")||0,10)+parseInt(a.dom.getStyle(b,"padding-left")||0,10)}var b=a.selection,e=a.dom;return d(b.getStart())||d(b.getEnd())||a.queryCommandState("InsertOrderedList")||a.queryCommandState("InsertUnorderedList")||a.queryCommandState("InsertInlineTaskList")}},"state")});a.onKeyUp.add(function(f,g){if("TABBING"==p)return f.execCommand(g.shiftKey?"Outdent":"Indent",!0,null),c(b()),p="UNKNOWN",s.cancel(g);if("EMPTY"==p){var e=b();f.execCommand(!0===f.settings.list_outdent_on_enter||g.shiftKey?
"Outdent":"Indent",!0,null);if(d.isIE){var h=a.dom.getParent(e,"ol,ul");null!=h&&(h=h.lastChild,h.appendChild(a.getDoc().createTextNode(o.Rte.HIDDEN_CHAR)),a.selection.setCursorLocation(h,0))}c(e);o.Rte.showSelection();return s.cancel(g)}if("ESCAPE"==p)if(d.isIE6||d.isIE7||d.isIE8)e=f.getDoc().createTextNode(o.Rte.HIDDEN_CHAR),f.selection.getNode().appendChild(e);else if(d.isIE9||d.isIE10||d.isIE11||d.isGecko||d.isWebKit)return f.execCommand("Outdent"),s.cancel(g)});a.onKeyDown.add(function(c,f){if(f.keyCode===
d.VK.TAB&&!f.altKey&&!f.ctrlKey&&(a.queryCommandState("InsertUnorderedList")||a.queryCommandState("InsertOrderedList")||a.queryCommandState("InsertInlineTaskList")||a.queryCommandState("InsertInlineTaskListNoToggle")))p="TABBING";else{var e;if(e=f.keyCode===d.VK.ENTER&&!f.shiftKey)if(e=b()){var h=e.parentNode.parentNode;e=e.parentNode.lastChild===e&&!(q(h)?h.parentNode&&"LI"===h.parentNode.tagName:"LI"===h.tagName)&&k(e)}else e=!1;p=e?"ESCAPE":f.keyCode===d.VK.ENTER&&!f.shiftKey&&a.selection.isCollapsed()&&
k(b())?"EMPTY":"UNKNOWN"}});a.onKeyDown.add(function(a,b){("TABBING"==p||"EMPTY"==p||(d.isGecko||d.isWebKit)&&"ESCAPE"==p)&&s.cancel(b)});a.onKeyDown.add(function(a,b){var e;if(d.isGecko){var c=a.selection.getStart();if(!(b.keyCode!=d.VK.BACKSPACE||"IMG"!==c.tagName))if(e=c.parentNode.previousSibling){if(!("UL"===e.tagName||"OL"===e.tagName))if(e.previousSibling&&("UL"===e.previousSibling.tagName||"OL"===e.previousSibling.tagName))e=e.previousSibling;else return;e=e.firstChild;var f=null;do{if(!e)break;
"LI"===e.tagName&&(f=e)}while(e=e.nextSibling);e=f;f=a.dom.createRng();f.setStart(e,1);f.setEnd(e,1);a.selection.setRng(f);a.selection.collapse(!0);var f=a.selection.getBookmark(),g=c.parentNode.cloneNode(!0);if("P"===g.tagName||"DIV"===g.tagName)for(;0<g.childNodes.length;)e.appendChild(g.childNodes[0]);else e.appendChild(g);c.parentNode.parentNode.removeChild(c.parentNode);a.selection.moveToBookmark(f)}}});a.onKeyDown.add(function(b,c){var e;if(e=c.keyCode===d.VK.ENTER&&!c.shiftKey){var f=a.selection.getNode();
e=a.dom.is(f,"h1,h2,h3,h4,h5,h6,p,div")&&"LI"===f.parentNode.tagName&&f.parentNode.lastChild===f;f=o.EditorUtils.isCursorAtEndOf(f,a.selection.getRng(!0));e=a.selection.isCollapsed()&&e&&f}if(e){b.undoManager.beforeChange();b.undoManager.add();e=b.selection.getNode();var g=b.dom.create("li",{},!d.isIE?'<br data-mce-bogus="true">':"");e=b.dom.getParent(e,"li");b.dom.insertAfter(g,e);d.isIE6||d.isIE7||d.isIE8?(g.appendChild(b.dom.create("&nbsp;")),b.selection.setCursorLocation(g,1)):d.isGecko?setTimeout(function(){b.selection.setCursorLocation(g,
0)},0):b.selection.setCursorLocation(g,0);b.undoManager.add();c.preventDefault()}});d.isWebKit&&(a.onNodeChange.add(g),a.onKeyUp.add(g));d.isIE?a.onKeyDown.add(m):(a.onNodeChange.add(j),d.isGecko&&a.onKeyDown.add(m));d.isGecko&&a.onKeyDown.add(l);d.isWebKit&&a.onKeyDown.add(f)},applyList:function(a,b,k,c){function f(a){a&&"BR"===a.tagName&&i.remove(a)}function j(a){a&&"LI"===a.tagName&&(i.removeClass(a,"checked"),a.removeAttribute("data-inline-task-id"))}function m(a){if(w&&a&&"LI"===a.tagName)for(var b in w)a.setAttribute(b,
w[b])}function g(b){function e(a){(a.style.marginLeft||a.style.paddingLeft)&&h.adjustPaddingFunction(!1)(a)}var c=i.create(a),g;""!=k&&(c.className=k);if("LI"===b.tagName)m(b);else{if("P"===b.tagName||"DIV"===b.tagName||"BODY"===b.tagName){p(b,function(a,c){l(a,c,b.tagName==="BODY"?null:a.parentNode);g=a.parentNode;e(g);(!d.isChrome||d.isChrome&&c&&c.parentNode&&i.isBlock(c.parentNode))&&f(c)});if(g){if("LI"===g.tagName&&("P"===b.tagName||1<A.length)){if(B&&h.isEmptyElement(g)){var n=document.createTextNode(B),
c=i.create("span");c.appendChild(n);g.appendChild(c);setTimeout(function(){t.selection.select(n)},0);(d.isIE7||d.isIE8)&&g.appendChild(t.dom.create("br",{_mce_bogus:"1"}));var j=function(a,b){if((b.which||b.keyCode)==64)if(n.textContent==B)n.textContent=" ";else if(n.data==B)n.data=" ";window.setTimeout(function(){t.onKeyPress.remove(j)},0)};t.onKeyPress.addToTop(j)}i.split(g.parentNode.parentNode,g.parentNode)}x(g.parentNode,!0);m(g)}return}g=i.create("li");m(g);i.insertAfter(g,b);g.appendChild(b);
e(b);b=g}i.insertAfter(c,b);c.appendChild(b);x(c,!0);q.push(b)}function l(a,b,c){for(var d=a;!i.isBlock(a.parentNode)&&a.parentNode!==i.getRoot();)a=i.split(a.parentNode,a.previousSibling),d=a=a.nextSibling;if(c){c=c.cloneNode(!0);for(a.parentNode.insertBefore(c,a);c.firstChild;)i.remove(c.firstChild);c=i.rename(c,"li")}else c=i.create("li"),a.parentNode.insertBefore(c,a);d&&d==b&&(a=i.create("br"),i.setAttrib(a,"data-mce-bogus",1),c.appendChild(d),i.insertAfter(a,d));for(;d&&d!=b;)a=d.nextSibling,
c.appendChild(d),d=a;0===c.childNodes.length&&(c.innerHTML='<br _mce_bogus="1" />');g(c)}function p(a,b){function c(a,b){var d=i.createRng(),e;z.keep=!0;t.selection.moveToBookmark(z);z.keep=!1;e=t.selection.getRng(!0);b||(b=a.parentNode.lastChild);d.setStartBefore(a);d.setEndAfter(b);return!(0<d.compareBoundaryPoints(g,e)||0>=d.compareBoundaryPoints(h,e))}function d(a){if(a.nextSibling)return a.nextSibling;if(!i.isBlock(a.parentNode)&&a.parentNode!==i.getRoot())return d(a.parentNode)}var e,f,g=3,
h=1;e=a.firstChild;var k=!1;y(i.select("br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl",a),function(a){if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;c(e,a)&&(i.addClass(a,"_mce_tagged_br"),e=d(a))});k=e&&c(e,void 0);e=a.firstChild;y(i.select("br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl",a),function(a){var c=d(a);if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;i.hasClass(a,"_mce_tagged_br")?(b(e,a,f),f=null):f=a;e=c});
k&&b(e,void 0,f)}function n(a){p(a,function(a,b,c){l(a,b);f(b);f(c)})}function o(a){j(a);if(-1===d.inArray(q,a)){if(a.parentNode.tagName===b||!v)i.split(a.parentNode,a),g(a),G(a.parentNode,!1);""!=k&&(a.parentNode.className=k);m(a);q.push(a)}}function e(a){j(a);var b,c;if(-1===d.inArray(q,a)&&(a=C(a,i))){for(;i.is(a.parentNode,"ol,ul,li");)i.split(a.parentNode,a);q.push(a);a=i.rename(a,"p");b=x(a,!1,t.settings.force_br_newlines);if(b===a)for(a=a.firstChild;a;)i.isBlock(a)?(a=i.split(a.parentNode,
a),c=!0,b=a.nextSibling&&a.nextSibling.firstChild):(b=a.nextSibling,c&&"BR"===a.tagName&&i.remove(a),c=!1),a=b}}var h=this,t=h.ed,i=t.dom,q=[],r=!1,s=!1,u=!1,v=!1,A=t.selection.getSelectedBlocks(),k=k||"",c=c||{},w=c.attributesOnItems,B=c.placeholderText,c=c.noToggle;y(A,function(c){c=I(c,i);c="LI"===c.tagName?c.parentNode:c;v=c.className===k;c.tagName===b?s=!0:c.tagName===a?r=!0:u=!0});c=u&&!r||s||!v||0===A.length?{LI:o,H1:g,H2:g,H3:g,H4:g,H5:g,H6:g,P:g,BODY:g,DIV:1<A.length?g:n,defaultAction:n,
elements:this.selectedBlocks()}:c?{}:{defaultAction:e,elements:this.selectedBlocks()};this.process(c)},indent:function(){var a=this.ed,b=a.dom,k=[];this.process({LI:function(c){if(!F(a,c,k)&&(c=C(c,b))){var f=c,j=b.create("li",{style:v});b.insertAfter(j,f);var m=b.getParent(f,"ol,ul"),f=m.tagName,g=b.getStyle(m,"list-style-type"),m=m.className||"",l={};""!==g&&(l.style="list-style-type: "+g+";");f=b.create(f,l);""!=m&&(f.className=m);j.appendChild(f);(d.isIE7||d.isIE8)&&c.appendChild(a.dom.create("br",
{_mce_bogus:"1"}));f.appendChild(c);x(f.parentNode,!1);x(f,!1);k.push(c)}},defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(a,b){var k=this,c=k.ed,f=c.dom,j=[],m=b&&d.is(b,"array")?b:this.selectedBlocks();this.process({LI:function(a){var b,d;if(!F(c,a,j)){if(""!==f.getStyle(a,"margin-left")||""!==f.getStyle(a,"padding-left"))return k.adjustPaddingFunction(!1)(a);b=f.getStyle(a,"text-align",!0);if("center"===b||"right"===b)f.setStyle(a,"text-align","left");
else if(a=C(a,f))b=a.parentNode,d=a.parentNode.parentNode,"P"===d.tagName?f.split(d,a.parentNode):(f.split(b,a),"LI"===d.tagName?f.split(d,a):f.is(d,"ol,ul")||f.rename(a,"p")),f.hasClass(a.parentNode,"inline-task-list")?a.hasAttribute("data-inline-task-id")||a.setAttribute("data-inline-task-id",""):a.removeAttribute("data-inline-task-id"),j.push(a)}},defaultAction:this.adjustPaddingFunction(!1),elements:m});y(j,x)},isEmptyElement:function(a){var b=this.ed.dom;return 0===d.grep(a.childNodes,function(a){return!("BR"===
a.nodeName||"SPAN"===a.nodeName&&"bookmark"==b.getAttrib(a,"data-mce-type")||3===a.nodeType&&(a.nodeValue==String.fromCharCode(160)||""==a.nodeValue))}).length},process:function(a){function b(b){(d.isIE7||d.isIE8)&&D(b).find("br[_mce_bogus='1']").remove();m.removeClass(b,"_mce_act_on");if(b&&!(1!==b.nodeType||1<g.length&&f.isEmptyElement(b))){var b=I(b,m),c=a[b.tagName];c||(c=a.defaultAction);c(b)}}function k(a){f.splitSafeEach(a.childNodes,b)}function c(a,b){return 0<=b&&a.hasChildNodes()&&b<a.childNodes.length&&
"BR"===a.childNodes[b].tagName}var f=this,j=f.ed.selection,m=f.ed.dom,g,l;if(!m.select("td.mceSelected.numberingColumn").length){g=a.elements;l=j.getRng(!0);if(!l.collapsed&&(c(l.endContainer,l.endOffset-1)&&(l.setEnd(l.endContainer,l.endOffset-1),j.setRng(l)),c(l.startContainer,l.startOffset)))l.setStart(l.startContainer,l.startOffset+1),j.setRng(l);if(d.isIE7||d.isIE8)if(l=f.ed.selection.getNode(),"LI"===l.tagName&&l.parentNode.lastChild!==l){var p=f.ed.getDoc().createTextNode(o.Rte.HIDDEN_CHAR);
l.appendChild(p)}z=j.getBookmark();a.OL=a.UL=k;f.splitSafeEach(g,b);j.moveToBookmark(z);z=null;j=j.getNode();null===m.getParent(j,"td")&&f.ed.execCommand("mceRepaint")}},splitSafeEach:function(a,b){d.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(a,b):y(a,b)},classBasedEach:function(a,b){var d=this.ed.dom,c;y(a,function(a){d.addClass(a,"_mce_act_on")});for(c=d.select("._mce_act_on");0<c.length;)c=c.shift(),d.removeClass(c,
"_mce_act_on"),b(c),c=d.select("._mce_act_on")},adjustPaddingFunction:function(a){var b,d,c=this.ed;b=c.settings.indentation;d=/[a-z%]+/i.exec(b);b=parseInt(b,10);return function(f){var j;j=parseInt(c.dom.getStyle(f,"margin-left")||0,10)+parseInt(c.dom.getStyle(f,"padding-left")||0,10);j=a?j+b:j-b;c.dom.setStyle(f,"padding-left","");c.dom.setStyle(f,"margin-left",0<j?j+d:"")}},selectedBlocks:function(){var a=this.ed,b=a.selection.getSelectedBlocks();return 0===b.length?[a.dom.getRoot()]:b},getInfo:function(){return{longname:"Lists",
author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:d.majorVersion+"."+d.minorVersion}}}});require("confluence/module-exporter").safeRequire("atlassian-tinymce/plugins/lists/editor_plugin_src",function(d){var o=require("tinymce");o.create("tinymce.plugins.Lists",d);o.PluginManager.add("lists",o.plugins.Lists)});