define("confluence-editor/files/file-item/file-item-model",["backbone","confluence/legacy","ajs","underscore","plupload"],function(f,d,c,g,e){return f.Model.extend({defaults:{id:-1,ownerId:-1,fileName:"",nonceUrl:"",isImage:!1,isFilePlaceHolder:!1,isSelect:!1,thumbnailUrl:"",downloadUrl:""},initialize:function(){var a=this;this._findDownloadUrl();this._findThumbnailUrl();this.set("fileName",this.getFileName());this.set("nonceUrl",this.getNonceUrl());this.set("isImage",this.isImage());this.set("isPreviewable",
this.isPreviewable());this.get("attachmentId")&&this.set("id",this.get("attachmentId"));this.get("isFilePlaceHolder")&&this.set("id",this.get("fileId"));this.listenTo(this,"change:link",function(){a.set("nonceUrl",a.getNonceUrl());a._findDownloadUrl()});this.set("iconAUIClass",this._parseFileNameToAuiIconClass(this.get("fileName")))},isImage:function(){return this.get("isImage")?!0:!!this.get("thumbnailUrl")},isPreviewable:function(){return"pdf document"===(this.get("niceType")||"").toLocaleLowerCase()||
this.isImage()},getFileName:function(){return this.get("fileName")||this.get("name")||""},getDestinationUrl:function(){return c.REST.wikiLink(this.attributes).destination},getNonceUrl:function(){var a=this.get("thumbnailUrl");if(0<=a.indexOf("modificationDate"))return a;var b=this.get("lastModifiedDate"),b=b?b.date:+new Date,b=encodeURIComponent(b);a&&(b=(a.indexOf("?")+1?"&":"?")+"nonce="+b,a+=b);return a},getRelativeUrl:function(a){if(!a)return a;0===a.indexOf(d.getBaseUrl())&&(a=a.replace(d.getBaseUrl(),
""),a=c.contextPath()+a);return a},_findThumbnailUrl:function(){!this.get("thumbnailUrl")&&this.get("thumbnailLink")&&this.set("thumbnailUrl",this.getRelativeUrl(this.get("thumbnailLink").href))},_findDownloadUrl:function(){var a=this.get("link");!this.get("downloadUrl")&&a&&(a=g.findWhere(a,{rel:"download"}).href,this.set("downloadUrl",this.getRelativeUrl(a)))},_getFileExtension:function(a){return a.substr(a.lastIndexOf(".")+1)},_parseFileNameToAuiIconClass:function(a){a="undefined"!==typeof e?e.mimeTypes[this._getFileExtension(a)]:
"";return c.Confluence.FileTypesUtils.getAUIIconFromMime(a)}})});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/files/file-item/file-item-model","Confluence.Editor.FileDialog.FileItemModel");