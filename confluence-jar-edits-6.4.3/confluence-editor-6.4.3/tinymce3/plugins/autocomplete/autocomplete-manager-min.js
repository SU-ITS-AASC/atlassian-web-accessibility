define("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-manager",["ajs","jquery","window","confluence-editor/tinymce3/plugins/autocomplete/autocomplete-settings","confluence-editor/tinymce3/plugins/autocomplete/autocomplete-control"],function(e,j,p,h,k){h.log("Autocompleter.Manager");var c,a,n=function(m){c=k(e.Rte.getEditor(),m);if(!c)return!1;e.trigger("synchrony.stop",{id:"confluence.autocomplete-plugin"});var q=j(p).width(),i,g=function(b){var f=j("#autocomplete-dropdown"),d=c.getContainer(),
a,m,g,h,l;f.length||(f=e("div").addClass("aui-dd-parent quick-nav-drop-down").attr("id","autocomplete-dropdown").appendTo("body"));a=e.Position.spaceAboveBelow(e.Rte.getEditorFrame(),d);b.find("ol:has(a.menu-header)").addClass("top-menu-item");b.find("ol:empty").hide();f.append(b);g=e.Rte.Content.offset(d);h=Math.max(f.width()+g.left-q+10,0);m=g.left-h-0;b=b.outerHeight(!0);l=b+10;if(i){var k;k=1==i?a.above>=l:a.below>=l;k||(i=null)}i||(i=a.below>=l?2:a.above>=l?1:a.below>a.above?2:1);a=f.find(".autocomplete-dropdown-arrow");
a.length||(a=j('<div class="autocomplete-dropdown-arrow"></div>'));1===i?(a.addClass("autocomplete-dropdown-bottom-arrow").css({top:b-1}),d=g.top-b-10):(a.removeClass("autocomplete-dropdown-bottom-arrow").css("top",""),d=g.top+d.height()+10);a.css({left:h}).appendTo(f);f.css({position:"absolute",top:d,left:m})};a=e.inputDrivenDropdown({onShow:function(b){e.trigger("rte-autocomplete-on-show",{triggerChar:c.settings.ch});var a=e.Rte.getEditorFrame();a&&a.shim&&a.shim.hide();b.find("a.menu-header").unbind().click(function(b){b.preventDefault();
c.die()});this.reset();c.settings.selectFirstItem&&b.find("a:not('.menu-header')").length&&e.dropDown.current.moveDown()},dropdownPlacement:g,onDeath:function(){j("#autocomplete-dropdown").remove()},ajsDropDownOptions:{selectionHandler:function(b,a){b.preventDefault();var d=j.data(a[0],"properties");d&&"function"===typeof d.callback?d.callback(c):"menu-header"!==d.className&&c.update(d);c.die()},moveHandler:function(b,a){var c=e.dropDown.current;b&&b.find("a").is(".menu-header")&&("up"==a?c.moveUp():
c.moveDown())},className:"autocomplete "+c.settings.dropDownClassName},getDataAndRunCallback:function(b){c&&c.settings.getDataAndRunCallback&&c.settings.getDataAndRunCallback(c,b,function(f,d,e,g){f.unshift([{className:"menu-header dropdown-prevent-highlight",href:"#",name:c.settings.getHeaderText(c,b)}]);f.push(c.settings.getAdditionalLinks(c,b,e));a&&a.show(f,d,g||[d])})},dropDownDelay:c.settings.dropDownDelay});c.onBeforeKey=function(b,a){var c=require("tinymce");return 40===b.keyCode||38===b.keyCode||
13===b.keyCode?(c.dom.Event.cancel(b),!1):27===b.keyCode||9===b.keyCode||8===b.keyCode&&!a?(this.die(8===b.keyCode),!1):!0};c.onKeyPress=function(b){var a=require("tinymce"),d=String.fromCharCode(j.browser.msie?b.keyCode:b.which);if(13===b.keyCode)return a.dom.Event.cancel(b),!1;-1!==e.indexOf(this.settings.endChars,d)&&c.die();return!0};var h=/\S{2,}/;c.onAfterKey=function(b,f){if(40===b.keyCode||38===b.keyCode||13===b.keyCode){var d=e.dropDown.current;if(!d)return!1;if(-1==d.getFocusIndex()&&13===
b.keyCode)return c.die(),c=null,!0;b.which||(b.which=b.keyCode);return d.moveFocus(b)}if(!(d=8===b.keyCode&&!f))d=/[\u4E00-\u9FFF]/gi.test(f);(d||h.test(f))&&a.change(f,d);return!0};c.onDeath=function(){a&&(a.remove(),a.closing=!0);e.trigger("synchrony.start",{id:"confluence.autocomplete-plugin"})};c.onScroll=function(){a.dd&&g(a.dd.$)};a.change(c.text(),"force");return!0},o={getInputDrivenDropdown:function(){return a},triggerListener:function(c,e){var i=require("tinymce");if(e.metaKey)return!0;var g=
j.browser.msie?e.keyCode:e.which;a&&a.closing&&(a=null);g=String.fromCharCode(g);!a&&g in h.Settings&&n({leadingChar:g})&&i.dom.Event.cancel(e);return!0},shortcutFired:function(e,h){var i=h?0:1;a&&a.closing&&(a=null);a&&(i=h?0:c.backWords+1,c.die(),c=null);return n({leadingChar:e,backWords:i})},reattach:function(){var a=k.removeOrphanedControl();a&&o.shortcutFired(a.leadingChar)}};return o});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/autocomplete/autocomplete-manager","Confluence.Editor.Autocompleter.Manager");