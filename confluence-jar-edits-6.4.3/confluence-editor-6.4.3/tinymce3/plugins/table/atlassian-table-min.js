define("confluence-editor/tinymce3/plugins/table/atlassian-table",["jquery","ajs","tinymce"],function(g,h,l){function p(){return g("#table-highlight-group").attr("data-highlight-colour")||""}function q(c){var j,g,d;j=0;for(g=c.length;j<g;j++)d=c.eq(j),d.attr("data-highlight-colour")&&d.removeAttr("data-highlight-colour"),d[0].className=d[0].className.replace(/( |^)highlight(-\w+)+/g,"")}function n(c,j){if(c.length){var f=h.Rte.getEditor(),d;d=g(h.Rte.getEditor().selection.getNode());d=d.length?d[0]===
c[0]?!0:!!d.closest(c).length:!1;for(var e=c[0],k=e.ownerDocument.createElement(j),i=e.attributes,m=0,l=i.length;m<l;m++){var a=i[m];k.setAttribute(a.nodeName,a.nodeValue)}for(;e.hasChildNodes();)k.appendChild(e.firstChild);e.parentNode.replaceChild(k,e);d&&(f.selection.select(k,!0),f.selection.collapse());return g(k)}}function o(){g(h.Rte.getEditor().getDoc().body).find(".confluenceTd.numberingColumn").attr("contenteditable","false")}var i={convertToNormalCells:function(c){c.filter("th").each(function(){var c=
g(this),c=n(c,"td");c.removeClass("confluenceTh");c.addClass("confluenceTd")})},convertToHeadingCells:function(c){c.filter("td").each(function(){var c=g(this),c=n(c,"th");c.removeClass("confluenceTd");c.addClass("confluenceTh")})},areCellsHeadings:function(c){var g=c.filter("th").length;return c.length===g},isColumnHeading:function(c,j){var f=g(c).children("tbody").children("tr");return 1===f.length?!1:f.children().nthCol(j).filter("th").length===f.length},areCellsHighlighted:function(c){var g=c.filter("td[data-highlight-colour],th[data-highlight-colour]");
if(c=c.length===g.length)a:{var c=p(),f,d,e;f=0;for(d=g.length;f<d;f++)if(e=g.eq(f).attr("data-highlight-colour")||"",e!==c){c=!1;break a}c=!0}return c},isColumnHighlighted:function(c,h){var f=g(c).children("tbody").children("tr").children("th,td").nthCol(h),d=f.filter("td[data-highlight-colour],th[data-highlight-colour]").length;if(f.length!==d)return!1;for(var d=f.eq(0).attr("data-highlight-colour"),e=1,i=f.length;e<i;e++)if(d!==f.eq(e).attr("data-highlight-colour"))return!1;return!0}};h.bind("init.rte",
function(c,j){function f(){var a=e.selection.getNode();return g(a).parents("table").is(".confluenceTable")?!e.dom.getParent(a,"UL,OL"):!1}var d,e=j.editor,k=function(a){return g(a.selection.getNode()).closest("th.confluenceTh,td.confluenceTd")},n=function(a){var b=g(a.getBody()).find("th.confluenceTh.mceSelected,td.confluenceTd.mceSelected");return b.length?b:k(a)},m=function(a){return 0===a.find("tbody > tr > td").length};e.addCommand("mceInsertTable",function(){h.Rte.BookmarkManager.storeBookmark();
if(!d){d=new h.Dialog({width:400,height:230,id:"insert-table-dialog",keypressListener:function(b){27===b.keyCode&&d.hide()}});d.addHeader("Insert Table");d.addPanel("Panel 1","panel1");d.getCurrentPanel().html(h.renderTemplate("tableForm","4","3"));g("#tinymce-table-form input[type='text']").click(function(){g(this).select()});var a=function(b){b.hide();e.plugins.table.insertTable()};g("#tinymce-table-form").keypress(function(b){13===b.keyCode&&a(d)});d.addButton("Insert",a,"ok");d.addCancel("Cancel",
function(b){b.hide();return!1},"cancel")}d.show()});e.addCommand("confTableRowToggleHeading",function(){var a;a=g(this.getBody()).find("td.mceSelected,th.mceSelected");a.length||(a=g(this.selection.getNode()));a=a.closest("tr");for(var b=a.parent(),b=b.is("tbody")?a.parent().parent():b;0!==a.length&&!b.is(".confluenceTable");)a=b.closest("tr"),b=a.parent(),b=b.is("tbody")?a.parent().parent():b;var b=a.children("td,th"),c=0;i.areCellsHeadings(b)?(m(a.closest("table"))||(b=b.filter(function(){var b=
g(this),a=b.closest("table");c+=b.attr("colspan")||1;return!i.isColumnHeading(a,c)})),i.convertToNormalCells(b)):i.convertToHeadingCells(b)});e.addCommand("confTableColumnToggleHeading",function(){var a;a=n(this);var b=g([]);a.each(function(){var a=g(this),c=a.index()+1,a=a.closest("table.confluenceTable").children("tbody").children("tr");b=b.add(a.children().nthCol(c))});a=b;i.areCellsHeadings(a)?(m(a.closest("table"))||(a=a.filter(function(){var a=g(this).parent("tr").children(),b=a.filter("th");
return a.length!==b.length})),i.convertToNormalCells(a)):i.convertToHeadingCells(a)});e.addCommand("confTableSelectionToggleHighlight",function(a,b){var c=b&&b.alwaysHighlight,e=n(this);e.filter("td");e.filter("th");i.areCellsHighlighted(e)&&!c||g("#table-highlight-group").attr("data-remove-highlight")?q(e):(q(e),p()&&(c=p(),e.attr("data-highlight-colour",c),e.addClass("highlight-"+c)))});(l.isIE8||h.DarkFeatures.isEnabled("confluence-table-enhancements.auto-row"))&&e.onKeyDown.add(function(a,b){function c(a,
b){var d=e.selection.getRng(!0),g=d.startContainer;if(d.collapsed){var f;a:{for(f=g;f!=a;){if(f[b]){f=!1;break a}f=f.parentNode}f=!0}return 3===g.nodeType?f&&d.startOffset==("nextSibling"==b?g.length:0):g==a?d.startOffset==("nextSibling"==b?g.childNodes.length-1:0):f}return!1}if((37===b.keyCode||39===b.keyCode)&&!b.shiftKey){var d=k(this);if(d.length){var d=d[0],f;if(f=37===b.keyCode)if(f=c(d,"previousSibling"))f=e.selection.getNode(),f=g(f).parents("table").first().find("tr:first-child").children().first()[0]!=
f;if(f)return e.execCommand("mceTableMoveCaretToPrevCell"),l.dom.Event.cancel(b);if(f=39===b.keyCode){if(d=c(d,"nextSibling"))d=e.selection.getNode(),d=g(d).parents("table").first().find("tr:last-child").children().last()[0]!=d;f=d}if(f)return e.execCommand("mceTableMoveCaretToNextCell"),l.dom.Event.cancel(b)}}});if(l.isWebKit){var o=g('<style type="text/css"></style>').html(".confluenceTable th,td { white-space: pre-wrap; }");g(e.getDoc().head).append(o)}e.onKeyDown.add(function(a,b){if(9===b.keyCode&&
f())return e.execCommand(b.shiftKey?"mceTableMoveCaretToPrevCell":"mceTableMoveCaretToNextCell"),b.preventDefault(),!1});h.DarkFeatures.isEnabled("confluence-table-enhancements.auto-row")&&(e.onClick.add(function(){var a=k(this);a.hasClass("numberingColumn")&&!a.hasClass("confluenceTh")&&e.execCommand("mceTableMoveCaretToNextCell")}),e.onKeyDown.addToTop(function(a,b){if((38===b.keyCode||40===b.keyCode)&&f()&&k(this).hasClass("numberingColumn"))return e.execCommand("mceTableMoveCaretToNextCell"),
b.preventDefault(),!1}))});h.DarkFeatures.isEnabled("confluence-table-enhancements.auto-row")&&(h.bind("quickedit.success",o),h.bind("init.rte",o));return i});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/table/atlassian-table","AJS.Rte.Table");