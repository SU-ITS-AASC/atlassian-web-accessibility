require(["ajs"],function(e){e.toInit(function(e){function t(t){return e(t).data("precedenceLevel")}function n(e,n){return n===t(e)}function r(i,o,c){if(0===i.length)return e();var u=i.map(t).reduce(function(e,t){return Math.min(e,t)});n(i[0],u)||i.unshift(function(t){var n=e({});return n.data("precedenceLevel",t),n}(u));var a=o.createTocLevelContainer(),s={subElements:[],currentItem:void 0,outline:void 0,flush:function(){this.subElements.length>0&&this.currentItem&&(r(this.subElements,o,this.outline).appendTo(this.currentItem),this.subElements=[])},add:function(e){this.subElements.push(e)},resetItem:function(e){return this.outline=(c||[]).slice(0),this.outline.push(e),this.currentItem=o.createTocItemContainer(),this.currentItem.appendTo(a),this.currentItem}},l=0;return i.forEach(function(t){n(t,u)?(l++,s.flush(),s.resetItem(l),t.textContent?function(t,n){var r=t.id.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\\\$&");return e(Confluence.Plugins.TableOfContents.Client.tocItemBody({outline:n,linkHref:"#"+t.id,focusLink:'$("#'+r+'").focus();',linkText:t.textContent}))}(t,s.outline.join(".")).appendTo(s.currentItem):s.currentItem.addClass("toc-empty-item")):s.add(t)}),s.flush(),0===c.length&&o.decorateToc&&o.decorateToc(a),a}function i(t,n){var i=n.headerelements,o=i.split(","),c=function(t){var n;t.includeheaderregex&&(n=new RegExp(t.includeheaderregex));var r;return t.excludeheaderregex&&(r=new RegExp(t.excludeheaderregex)),function(){var t=e(this).text();return!(n&&!n.test(t)||r&&r.test(t))}}(n);return r(e("#main-content").find(i).filter(c).each(function(){e(this).attr("tabindex","-1"),function(t,n){e(t).data("precedenceLevel",n)}(this,o.indexOf(this.nodeName))}).toArray(),t,[])}e(".client-side-toc-macro").each(function(){var t,n=e(this),r=n.data()||{};t="flat"===r.structure?function(t){return{createTocLevelContainer:function(){return this.createTocItemContainer()},createTocItemContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer({cssClass:"toc-item-container"}))},decorateToc:function(n){function r(r,i){var o=r in t?t[r]:i;o&&e(Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator({separator:o})).appendTo(n)}r("preseparator","[ "),e(n).find("span.toc-item-body").each(function(t,i){t>0&&r("midseparator"," ] [ "),e(i).appendTo(n)}),r("postseparator"," ]"),e(n).find(".toc-item-container").remove()}}}(r):function(t){return{createTocLevelContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer({cssliststyle:t.cssliststyle,csslistindent:t.csslistindent}))},createTocItemContainer:function(){return e(Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer())}}}(r),!0!==r.numberedoutline&&n.addClass("hidden-outline"),n.html(i(t,r))})})});