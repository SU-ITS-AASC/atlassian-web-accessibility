(function(f){function g(a,b){AJS.log("blueprint-how-to: marking skipHowToUse for "+a+", "+b);var c=Confluence.getContextPath()+"/rest/create-dialog/1.0/blueprints/skip-how-to-use";AJS.safe.post(c,{contentBlueprintId:a,skip:b}).done(function(){AJS.log("blueprint-how-to: Saved skipHowToUse for "+a+", "+b)}).fail(function(){AJS.log("blueprint-how-to: FAILED SAVE skipHowToUse for "+a+", "+b)})}function h(a,b,c){AJS.log("blueprint-how-to: showing how-to-use page");a.addPage("how-to-use-blueprint-page");
f(".dialog-page-body.how-to-use-blueprint-page").attr("data-content-blueprint-id",b.contentBlueprintId).attr("data-blueprint-key",b.blueprintModuleCompleteKey);var d=a.getPage(a.curpage),e=AJS.I18n.getText("create.content.plugin.create-dialog.header.how-to.label");d.addHeader(e);e=eval(b.howToUseTemplate+"()");d.addPanel("how-to-panel",e);a.addBackButton(d);a.addButtonPanel(d,c,!b.wizard,"how-to-button-panel");AJS.Meta.get("remote-user")&&(d.buttonpanel.append(Confluence.Templates.Blueprints.howToUseSkipCheckbox()),
c=!(!a.blueprintHowTosSkipped||!a.blueprintHowTosSkipped[b.contentBlueprintId]),d.buttonpanel.find("#dont-show-how-to-use").change(function(){var c=f(this).prop("checked");c?(a.blueprintHowTosSkipped=a.blueprintHowTosSkipped||{},a.blueprintHowTosSkipped[b.contentBlueprintId]=!0):delete a.blueprintHowTosSkipped[b.contentBlueprintId];g(b.contentBlueprintId,c)}).prop("checked",c))}Confluence.Blueprint.HowToUse={check:function(a,b,c){AJS.log("blueprint-how-to: checking status and showing How-to-Use page if needed");
b.skipHowToUse?c():h(a,b,c)},notifyCancel:function(a){AJS.log("blueprint-how-to: cancel notified");a.blueprintHowTosSkipped&&_.each(a.blueprintHowTosSkipped,function(a,c){g(c,!1)})}}})(AJS.$);