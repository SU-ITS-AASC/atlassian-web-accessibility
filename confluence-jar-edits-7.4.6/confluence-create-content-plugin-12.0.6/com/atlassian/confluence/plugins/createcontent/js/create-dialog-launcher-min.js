(function(){function f(a,b,c){Confluence.Blueprint.Dialog.requestWebItems(a,b,function(b){var d=Confluence.Blueprint.Dialog.loadedWebitems[a];_.isEmpty(d)?AJS.log("create-from-template-macro: No Create dialog web items found for spaceKey \x3e"+a+"\x3c"):c(b,d)},function(){AJS.error("create-from-template-macro: requestWebItems call for spaceKey \x3e"+a+"\x3c failed")})}function h(){var a={};AJS.$("#create-dialog-init-params div").each(function(){a[$(this).data("key")]=$(this).data("value")});return a}
AJS.toInit(function(){Confluence.Blueprint=$.extend(Confluence.Blueprint,{loadDialogAndOpenTemplate:function(a){if(!_.isObject(a))throw Error("Confluence.Blueprint.loadDialogAndOpenTemplate called with no options");var b=a.spaceKey,c=a.contentBlueprintId,d=a.templateId,g=a.title;a=a.initContext?a.initContext:h();b?Confluence.Blueprint.loadDialog({showDialog:!0,updateHeight:!1,showStepOne:!0,initContext:a}).done(function(a){f(b,!0,function(k,e){if(e=_.find(e,function(a){return c?a.contentBlueprintId==
c:a.templateId==d})){var f=e.itemModuleCompleteKey;e=$.extend({},e);e.title=g;e.spaceKey=""+b;AJS.trigger(Confluence.Dialogs.Events.ITEM_SELECTED,{config:e});Confluence.Blueprint.fireWizard(k,e,a);a.removeBackButton();(e.howToUseTemplate&&!e.skipHowToUse||Confluence.Blueprint.hasWizard(f,e))&&a.show()}else AJS.log("create-from-template-macro: No Create dialog web item found for contentBlueprintId \x3e"+c+"\x3c and templateId \x3e"+d+"\x3c")})}):Confluence.Blueprint.loadDialog({initContext:a})}})});
AJS.getWindowQueryParams=function(){var a={};if(1<window.location.search.length)for(var b=window.location.search.substr(1).split("\x26"),c=0;c<b.length;c++){var d=b[c].split("\x3d"),g=unescape(d[0]);d=1<d.length?unescape(d[1]):"";a[g]=d}return a};AJS.toInit(function(){var a=h();if(a.createSpaceDialog)Confluence.SpaceBlueprint.loaded.then(function(){Confluence.SpaceBlueprint.Dialog.launch()});else{var b=AJS.getWindowQueryParams(),c=b.createDialogSpaceKey;if(b.createDialog||c){var d=b.createDialogBlueprintKey;
c&&d&&(f(c,!1,function(a,c){(a=_.find(c,function(a){return a.blueprintModuleCompleteKey==d}))?b.createDialogBlueprintId=a.contentBlueprintId:AJS.log("No blueprint found with key: "+d)}),delete b.createDialogBlueprintKey);!c||b.createDialogBlueprintId||b.createDialogTemplateId?Confluence.Blueprint.loadDialogAndOpenTemplate({spaceKey:c,contentBlueprintId:b.createDialogBlueprintId,templateId:b.createDialogTemplateId,initContext:a}):AJS.log("Confluence.Blueprint.launchDialog triggered with incorrect options - please check the URL query: "+
window.location.search)}}})})();