(function(g){Confluence.Dialogs=Confluence.Dialogs||{};Confluence.Dialogs.LocationPanel=function(h){function r(a,b){f.find(".template-select-container").addClass("loading");g("#create-dialog").find(".wait-icon").spin("medium");b.requestWebItems(a).done(function(a){b.fillWebItemsInDialog(!1);g("#create-dialog").find(".wait-icon").spinStop()}).fail(function(){Confluence.sessionFail&&Confluence.sessionFail()})}function t(a){var b=[],c=a.promotedSpaces.spaces;c&&c.length&&b.push({text:AJS.I18n.getText("create.content.plugin.promoted.spaces"),
children:c});(a=a.otherSpaces&&!a.otherSpaces.resultsTruncated&&a.otherSpaces.spaces)&&a.length&&b.push({text:AJS.I18n.getText("spaces.all"),children:a});return b}function u(a,b){if(a.otherSpaces&&a.otherSpaces.resultsTruncated){var c=b.find(".space-select-control-container .description");c.removeClass("hidden");c.find("a").tooltip({gravity:"w",delayIn:500,delayOut:0,offset:5}).click(function(){return!1})}d.auiSelect2({data:t(a),escapeMarkup:function(a){return a},width:"270px",containerCssClass:"select2-space-select",
formatResult:function(a,b,c){b.attr("title",g("\x3cdiv/\x3e").html(a.text).text());return g.fn.select2.defaults.formatResult.apply(this,arguments)},openOnEnter:!1});var e=d.data("select2");e.data(a.promotedSpaces.spaces[0]||a.otherSpaces.spaces[0]);var f=e.opts.populateResults;e.opts.populateResults=function(a,b,c){var h=!1,d=b;b[1]&&b[1].children&&50<b[1].children.length&&(d=[],g(b).each2(function(){d.push(g.extend(!0,{},this))}),d[1].children=d[1].children.slice(0,50),d[1].children.push({text:AJS.I18n.getText("create.content.plugin.select.space.see.more")}),
h=!0);f.call(e,a,d,c);h&&b[1].children.pop()};a=b.find(".select2-space-select .select2-input");a.length&&"placeholder"in a[0]&&a.attr("placeholder",AJS.I18n.getText("create.content.plugin.create-dialog.space.dropdown.filter.placeholder-text")+" ...")}function n(a){return g.ajax({url:Confluence.getContextPath()+"/rest/create-dialog/1.0/spaces/adminCheck",dataType:"json",data:{spaceKey:a}})}function p(a,b){var c=b.find(".add-remove-customise-templates-trigger"),e=Confluence.getContextPath();a?(e+="/pages/templates2/listpagetemplates.action?key\x3d"+
d.val(),a=AJS.I18n.getText("create.content.plugin.plugin.add.or.customize.templates")):(e+="/plugins/servlet/upm/marketplace/featured?category\x3dBlueprints",a=AJS.I18n.getText("create.content.plugin.plugin.find.more.content"));e=Confluence.Templates.Blueprints.customiseTemplatesLink({linkUrl:e,linkText:a});c.length?c.replaceWith(e):b.find(".dialog-button-panel:first").prepend(e)}AJS.bind(Confluence.Dialogs.Events.ITEM_SELECTED,function(a,b){if(k&&k.length){var c;b&&(b.config?c=b.config:b.item&&(c=
b.item.data()));a=c&&(c.itemModuleCompleteKey||c.templateId)||null;var e=g("#page-restricted-container").length||g(".request-access-container").length;(b=b.noVisibleItem||e)||(b=c.spaceKey,a?(c=AJS.Meta.get("space-key"),b=b||d.val(),a=c&&c==b&&Confluence.Blueprint.Util.getParentPageLocation().parentPageTitle&&"page"==AJS.Meta.get("content-type")&&"com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-blueprint-item"!=a?a!=q:!1):a=!0,b=!a);b?(k.hide(),l=null):(a=Confluence.Blueprint.Util.getParentPageLocation(),
k.find("span").text(a.parentPageTitle),k.show(),l=a.parentPageId)}else AJS.log("WARNING: refreshLocation should not be getting triggered - $locationDiv is not set")});var m,f,k,v=h.openDialog,d,l=null,q="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blog-post";h.openDialog=function(a){var b=a&&a.createDialog?a.createDialog:v(a);a&&a.dialogBase&&AJS.$.extend(b,a.dialogBase);f=b.popup.element;a.errorMessage?b.setDialogError(a.errorMessage):(a=f.find(".create-dialog-body").prepend(Confluence.Templates.Blueprints.createDialogLocationPanel({})),
k=a.find("#create-dialog-parent-container"),d=a.find(".space-select"),a=h.loadedSpaces,defaultSpace=a.promotedSpaces.spaces[0]||a.otherSpaces.spaces[0],u(a,f),f.options.showStepOne||h.fillWebItemsInDialog(!1),m||(m=n(defaultSpace.id)),m.done(function(a){p(a,f)}),f.find(".create-dialog-location-bar input.space-select").change(function(){var a=g(this).val();r(a,b);n(a).done(function(a){p(a,f)})}),f.options.updateHeight&&b.updateHeight());return b};h.getParentPageId=function(){return l};h.filterWebItems=
function(a){return"child-page"==f.options.location?_.reject(a,function(a){return a.itemModuleCompleteKey==q}):a};h.getSpaceKey=function(){return d.val()||AJS.Meta.get("space-key")}}})(AJS.$);