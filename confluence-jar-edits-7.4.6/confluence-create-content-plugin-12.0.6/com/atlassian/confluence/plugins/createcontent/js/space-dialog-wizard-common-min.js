AJS.toInit(function(c){function k(a){a?g.removeAttr("disabled"):g.attr("disabled","disabled")}function l(a){var b=a.attr("name"),c=a.siblings(".error");b=n[b]();b.done(function(){c.text("").addClass("hidden")});b.fail(function(a,b){b||c.text(a).removeClass("hidden")});b.always(function(){a.attr("data-validated-value",a.val())});return b}function q(a){function b(a){"pending"===a.state()&&a.reject("",!0)}function m(){l(c(this));c.when.apply(c,_.values(h)).done(function(){k(!0)}).fail(function(a,b){b||
k(!1)})}k(!1);e=a.find("input[name\x3d'spaceKey']").first();f=a.find("input[name\x3d'name']").first();e.parent().find(".error");f.parent().find(".error");e.generateFrom(f,{uppercase:!1,maxNameLength:255,maxKeyLength:255,timeoutMS:100,validationCallback:function(){e.trigger("input")}});var g=c.debounce(m,250),p=c.debounce(m,250);f.on("change input",function(){g.apply(this,arguments)});e.on("change input",function(){_.each(h,b);d&&d.abort();p.apply(this,arguments)});e.focus(function(){var a=e[0];if(a.setSelectionRange){var b=
e.val().length;a.setSelectionRange(0,b)}else a.createTextRange&&(a=a.createTextRange(),a.execCommand("SelectAll"),a.select())});a.find("#permission-private").change(function(){c("#permissions-group").toggleClass("aui-iconfont-unlocked");c("#permissions-group").toggleClass("aui-iconfont-locked")})}var e,f,g,d,h={name:c.Deferred().reject(),spaceKey:c.Deferred().reject()},n={spaceKey:function(){var a=c.Deferred(),b=c.trim(e.val());if(!b)return a.reject(AJS.I18n.getText("space.key.empty")),h.spaceKey=
a,a.promise();d&&(AJS.log("Aborting previous space key validation request."),d.abort());d=c.getJSON(AJS.Confluence.getContextPath()+"/ajax/spaceavailable.action",{key:b}).done(function(b){!b.available&&b.message?a.reject(b.message):a.resolve();d=!1});h.spaceKey=a;return a.promise()},name:function(){var a=c.Deferred();c.trim(f.val())?a.resolve():a.reject(AJS.I18n.getText("space.name.empty"));h.name=a;return a.promise()}};c(document).tooltip({live:".common-space-form .aui-iconfont-help",gravity:"w",
title:"data-tooltip",delayIn:250,delayOut:0});Confluence.SpaceBlueprint.CommonWizardBindings={preRender:function(a,b){b.soyRenderContext.atlToken=AJS.Meta.get("atl-token");b.soyRenderContext.showSpacePermission=!0},postRender:function(a,b){g=c(".create-dialog-create-button:visible");q(b.$container)},submit:function(a,b){setTimeout(function(){var a=l(e),d=l(f);c.when(a,d).done(b.validationDeferred.resolve).fail(function(){b.validationDeferred.reject.apply(this,arguments);k(!1)})},101);a=c("form.common-space-form");
var d="unknown";a.length&&(d=a.attr("id")||"blank-space");AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.blueprint-created",{blueprint:d}):AJS.trigger("analyticsEvent",{name:"confluence-spaces.blueprint-created",data:{blueprint:d}});b.async=!0;return!1}}});