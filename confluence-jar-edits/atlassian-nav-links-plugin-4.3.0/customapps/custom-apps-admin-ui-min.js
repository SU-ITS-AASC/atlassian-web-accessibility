AJS.$(document).ready(function(){var o=AJS.$("#custom-app-admin-content");var c=function(q){return{id:q,text:AJS.escapeHtml(q)}};var n=AJS.RestfulTable.CustomEditView.extend({render:function(t){var w=this;var r=AJS.$(customapps.admin.getAllowedGroupsEditView({allowedGroupsId:w.model.attributes.id}));var u=r.find("input");u.select2({separator:", ",multiple:true,formatNoMatches:function(){return AJS.I18n.getText("custom-apps.select2.formatNoMatches")},formatInputTooShort:function(s,x){return AJS.I18n.getText("custom-apps.select2.formatInputTooShort",(x-s.length))},formatSelectionTooBig:function(s){return AJS.I18n.getText("custom-apps.select2.formatSelectionTooBig",s)},formatLoadMore:function(s){return AJS.I18n.getText("custom-apps.select2.formatLoadMore")},formatSearching:function(){return AJS.I18n.getText("custom-apps.select2.formatSearching")},ajax:{url:AJS.contextPath()+"/rest/custom-apps/1.0/customapps/groups",dataType:"json",data:function(s,x){return{q:s,page_limit:10,page:x}},results:function(A,z){m();var y=[];for(var x in A.names){y.push(c(A.names[x]))}return{results:y,more:A.more}},transport:function(s){return AJS.$.ajax(AJS.$.extend({},s,{global:false,error:function(x,z,y){k(x.status)}}))}}});var q=[];for(var v in w.model.attributes.allowedGroups){q.push(c(w.model.attributes.allowedGroups[v]))}u.select2("data",q);if(w.model.attributes.hide){u.select2("disable")}else{u.select2("enable")}u.on("change",function(s){});r.find(".select2-input").addClass("ajs-dirty-warning-exempt");return r}});var a=AJS.RestfulTable.CustomReadView.extend({render:function(q){return q.value!=null?AJS.escapeHtml(q.value.join(", ")):""}});var e=AJS.RestfulTable.CustomEditView.extend({render:function(q){var s=this;var r=AJS.$(customapps.admin.getHideEditViewCheckBox({hideId:s.model.attributes.id}));r.prop("checked",q.value);var t=AJS.$(customapps.admin.getHideEditViewHidden());r.change(function(u){var v=AJS.$("#allowedGroupsId"+s.model.attributes.id);if(r.prop("checked")){t.val("true");v.children("input").select2("disable")}else{t.val("false");v.children("input").select2("enable")}});return AJS.$.merge(r,t)}});var g=AJS.RestfulTable.CustomReadView.extend({render:function(q){return q.value?AJS.I18n.getText("custom-apps.manage.hidden"):""}});var h=AJS.RestfulTable.CustomReadView.extend({render:function(q){if(this.model.attributes.editable){return AJS.escapeHtml(q.value)}else{return AJS.$(customapps.admin.getReadView({value:q.value}))}},isEditable:function(q){return this.model.attributes.editable}});var f=AJS.RestfulTable.CustomReadView.extend({render:function(q){if(q.allowEdit!==false&&(this.model.attributes.editable==undefined||this.model.attributes.editable)){return AJS.$(customapps.admin.getEditView({name:q.name,value:q.value==null?"":q.value}))}else{if(q.value){return document.createTextNode(q.value)}}}});var l=AJS.RestfulTable.CustomReadView.extend({render:function(q){if(q.value==undefined||q.value==null||q.value==""){return q.value}if(this.model.attributes.self!=undefined&&this.model.attributes.self){return""}if(this.model.attributes.applicationType!=undefined&&this.model.attributes.applicationType=="fecru"){var r=AJS.I18n.getText("custom-apps.manage.location");return AJS.$(customapps.admin.getSourceReadViewLocationLink({href:q.value,linkText:r}))}if(this.model.attributes.applicationType!=undefined&&this.model.attributes.applicationType=="jira"&&q.value.toLowerCase().indexOf("bitbucket.org")>=0){var r=AJS.I18n.getText("custom-apps.manage.location");return AJS.$(customapps.admin.getSourceReadViewLocationLink({href:q.value,linkText:r}))}var r=AJS.I18n.getText("custom-apps.manage.manage");return AJS.$(customapps.admin.getSourceReadViewManageLink({href:q.value,linkText:r}))}});var p=AJS.RestfulTable.EditRow.extend({mapSubmitParams:function(q){q.allowedGroups=this.$el.find('input[name="allowedGroups"]').select2("val");return this.model.changedAttributes(q)}});var b=AJS.RestfulTable.Row.extend({initialize:function(q){q=q||{};q.allowEdit=true;q.allowDelete=this.model.attributes.editable;this.bind(AJS.RestfulTable.Events.EDIT_ROW,m);this.constructor.__super__.initialize.apply(this,[q]);this._event=this._event||this._events},render:function(){var q=this,s=this.model.toJSON(),t=AJS.$("<td class='aui-restfultable-operations' />").append(this.renderOperations({},s)),r=AJS.$("<td class='aui-restfultable-throbber' />");this.$el.removeClass(this.classNames.DISABLED+" "+this.classNames.FOCUSED+" "+this.classNames.LOADING+" "+this.classNames.EDIT_ROW).addClass(this.classNames.READ_ONLY).empty();if(this.allowReorder){AJS.$('<td  class="'+this.classNames.ORDER+'" />').append(this.renderDragHandle()).appendTo(q.$el)}this.$el.attr("data-id",this.model.id);AJS.$.each(this.columns,function(z,x){var w,B=AJS.$("<td />"),C=s[x.id],D=x.fieldName||x.id,A=[{name:D,value:C,allowEdit:x.allowEdit},s,q.model];if(C){q.$el.attr("data-"+x.id,C)}var v=true;if(x.readView){var y=new x.readView({model:q.model});w=y.render(A[0]);if(y.isEditable){v=y.isEditable(A[0])}}else{w=q.defaultColumnRenderer.apply(q,A)}if(q.allowEdit!==false&&x.allowEdit!==false&&v){var u=AJS.$("<span />").addClass(q.classNames.EDITABLE).append('<span class="aui-icon icon-edit-sml aui-icon-small aui-iconfont-edit" />').append(w).attr("data-field-name",D);B=AJS.$("<td />").append(u).appendTo(q.$el);if(!w||AJS.$.trim(w)==""){B.addClass(q.classNames.NO_VALUE);u.html(AJS.$("<em />").text(this.emptyText||AJS.I18n.getText("aui.enter.value")))}}else{B.append(w)}if(x.styleClass){B.addClass(x.styleClass)}B.appendTo(q.$el)});this.$el.append(t).append(r).addClass(this.classNames.ROW+" "+this.classNames.READ_ONLY);this.trigger(this._event.RENDER,this.$el,s);this.$el.trigger(this._event.CONTENT_REFRESHED,[this.$el]);return this}});var j=new AJS.RestfulTable({autoFocus:true,el:o,allowReorder:true,createPosition:"top",addPosition:"bottom",resources:{all:AJS.contextPath()+"/rest/custom-apps/1.0/customapps/list",self:AJS.contextPath()+"/rest/custom-apps/1.0/customapps"},views:{row:b,editRow:p},columns:[{id:"displayName",header:AJS.I18n.getText("common.words.displayName"),editView:f,readView:h,styleClass:"custom-apps-restfultable-displayname"},{id:"url",header:AJS.I18n.getText("common.words.url"),editView:f,readView:h},{id:"sourceApplicationUrl",header:AJS.I18n.getText("common.words.source"),readView:l,allowEdit:false},{id:"hide",header:AJS.I18n.getText("common.words.hide"),editView:e,readView:g,emptyText:AJS.I18n.getText("common.words.clickToEdit"),styleClass:"custom-apps-restfultable-hide"},{id:"allowedGroups",header:AJS.I18n.getText("common.words.groups"),editView:n,readView:a,emptyText:AJS.I18n.getText("common.words.clickToEdit"),styleClass:"custom-apps-restfultable-groups"}]});jQuery(AJS).bind(AJS.RestfulTable.Events.SERVER_ERROR,function(s,r,q){k(q.status)});AJS.$(AJS).bind(AJS.RestfulTable.Events.REORDER_SUCCESS,m);AJS.$(AJS).bind(AJS.RestfulTable.Events.ROW_ADDED,m);AJS.$(AJS).bind(AJS.RestfulTable.Events.ROW_REMOVED,m);function k(r){m();var s;var q;if(r===0||r>=400&&r<600){switch(r){case 401:q=AJS.I18n.getText("custom-apps.ajax.error.occured.body.loggedOut",AJS.$("#custom-apps-login-redirect-url").val());s=AJS.I18n.getText("custom-apps.ajax.error.occured.title.loggedOut");break;default:s=AJS.I18n.getText("custom-apps.ajax.error.occured.title.default");q=AJS.I18n.getText("custom-apps.ajax.error.occured.body.default")}}AJS.messages.warning({title:s,body:q,id:"custom-apps-ajax-error",closeable:false})}function m(){AJS.$("#custom-apps-ajax-error").closeMessage()}var i=false;var d=function(){j.$theadRow.find("th:last").append(customapps.admin.refreshButton());var r=AJS.$("#refresh-capabilities-link"),q=r.find("#refresh-capabilities-icon");r.click(function(s){s.preventDefault();q.removeClass("aui-iconfont-build").addClass("aui-icon-wait");AJS.$.ajax({url:AJS.contextPath()+"/rest/capabilities-consumer/1.0/admin/refreshcache",type:"POST",success:function(){AJS.$.each(j.getRows(),function(){j.removeRow(this)});AJS.$.get(j.options.resources.all,function(t){j.populate(t)});q.removeClass("aui-icon-wait").addClass("aui-iconfont-build")},error:function(){}})});i=true};AJS.$(j).bind(AJS.RestfulTable.Events.INITIALIZED,function(){if(!i){d()}})});