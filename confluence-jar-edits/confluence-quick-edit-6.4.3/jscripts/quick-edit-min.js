define("confluence-quick-edit/quick-edit","ajs confluence/legacy confluence/templates confluence/meta jquery window document confluence-quick-edit/util wrm".split(" "),function(b,d,q,i,c,r,s,t,u){function v(){var a=new c.Deferred;b.Confluence.EditorLoader.load(function(){setTimeout(function(){a.resolve()},0)},function(){a.reject()});return a}var o={enableShortcut:function(){c("#editPageLink").addClass("full-load")},disableShortcut:function(){c("#editPageLink").removeClass("full-load")}},g=[],n={loadingContentTimeout:4E3,
register:function(a){g.push(a)},disableHandlers:function(){c.each(g,function(a,b){return b.disable()})},enableHandlers:function(){c.each(g,function(a,b){return b.enable()})},SaveBarBinder:{bind:function(a,b){a&&d.Editor.addSaveHandler(a);b&&d.Editor.addCancelHandler(b)}},activateEditor:function(a){function d(){function f(b){var a=new c.Deferred;u.require(b).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)});return a}var g,j=new c.Deferred;if(b.Rte&&b.Rte.getEditor()){b.debug("there is already an editor open");
return j.reject("there is already an editor open")}if(!a.$container||!a.$form){b.logError("activateEditor could not be initialsed: bad arguments",a);return j.reject("bad parameters")}g=b.Confluence.BlockAndBuffer.block(c(s));a.preActivate&&a.preActivate();o.disableShortcut();var p=a.timeoutResources||b.Confluence.EditorLoader.loadingTimeout,l=n.loadingContentTimeout,h=t.timeoutDeferred;c.when(h("resources",v(),p),h("fetch content",a.fetchContent||c.Deferred().resolve(),l),h("additional resources",
a.additionalResources?f(a.additionalResources):c.Deferred().resolve(),p)).done(function(d,f){var e={$container:a.$container,content:f,$form:a.$form,replayBufferedKeys:g};a.preInitialise&&a.preInitialise(e);c(".quick-comment-prompt",e.$container).hide();c(".quick-comment-body",e.$container).addClass("comment-body");var k=b.Confluence.EditorLoader.getPreloadContainer();if(e.content&&e.content.title){var m=e.content.title;k.find("#content-title").val(m)}e.$form.append(k.children());k.show();c("#editor-precursor").hide();
c("#rte-savebar").find(".toolbar-split-left").hide();if(i.get("content-type")==="comment"){c("#pluggable-status").hide();var k=q.Editor.Page.cancelButton({contentType:i.get("content-type"),sharedDraftsEnabled:i.getBoolean("shared-drafts")}),m=c("#rte-button-cancel"),l=m.parent(".rte-toolbar-group-done");if(l.length){l.remove();c("#rte-button-discard").remove()}else m.remove();c("#rte-savebar").find(".toolbar-split-right").append(k)}var h=function(){e.editor=b.Rte.getEditor();e.$container.find(".quick-comment-loading-container").hide();
e.$form.show();e.$form.addClass("fadeIn");var d=e.editor,f=e.content?e.content.editorContent:"",g=e.replayBufferedKeys;if(f){b.debug("Initial Editor Content from quick edit: ",f);d.setContent(f);d.startContent=d.getContent({format:"raw",no_events:1});d.undoManager.clear()}g()&&d.undoManager.add();b.trigger("quickedit.success");b.trigger("quickedit.visible");b.trigger("add-bindings.keyboardshortcuts");b.trigger("active.dynamic.rte");c("div.aui-message.closeable").each(function(){var a=c(this),d;if(!a.find(".icon-close").length){d=
c('<span class="aui-icon icon-close" role="button" tabindex="0"></span>').click(function(){a.closeMessage()}).keypress(function(c){if(c.which===b.keyCode.ENTER||c.which===b.keyCode.SPACE){a.closeMessage();c.preventDefault()}});a.append(d)}});a.postInitialise&&a.postInitialise(e);n.SaveBarBinder.bind(a.saveHandler,a.cancelHandler);b.trigger("rte-quick-edit-ready");d=i.get("content-type");i.get("collaborative-content")&&(d==="page"||d==="blogpost")&&b.trigger("rte-collab-editor-loaded");b.unbind("rte-ready",
h);j.resolve()};b.bind("rte-ready",h);b.bind("rte-destroyed",a.postDeactivate||function(){});b.Rte.BootstrapManager.initialise({plugins:a.plugins,toolbar:a.toolbar,excludePlugins:a.excludePlugins,isQuickEdit:true,onInitialise:a.onInitialise})}).fail(function(c,d){j.reject(c,d);b.logError("Error loading page quick edit. Falling back to normal edit URL...");b.trigger("analytics",{name:"rte.quick-edit.activate-editor.failed"});if(a.fallbackUrl){b.log("This parameter is deprecated. To be removed in the next major version (5.8 or 6.0). Please use the promise returned to bind custom action if the editor fails to load instead.");
r.location=a.fallbackUrl}});return j.promise()}if(a.closeAnyExistingEditor&&b.Rte&&b.Rte.getEditor()){var f=new c.Deferred;this.deactivateEditor().done(function(){d().done(function(){f.resolve()}).fail(function(a){f.reject(a)})}).fail(function(){b.debug("Could not deactivate current editor.");f.reject("Could not deactivate current editor.")});return f.promise()}return d()},deactivateEditor:function(){require("tinymce").execCommand("mceRemoveControl",true,"wysiwygTextarea");d.Editor.UI.toggleSavebarBusy(false);
var a=b.Confluence.EditorLoader.getPreloadContainer().empty();c(".editor-container").remove();c("#editor-precursor").remove();c("#anonymous-warning").remove();c(".quick-comment-prompt").show();c(".bottom-comment-panels").show();c("#editor-notification-container").empty();c(".action-reply-comment").removeAttr("reply-disabled");o.enableShortcut();d.Editor.removeAllSaveHandlers();d.Editor.removeAllCancelHandlers();return b.Confluence.EditorLoader.getEditorPreloadMarkup().done(function(c){a.append(c);
a.hide();(new b.Confluence.QuickEditCaptchaManager(a)).refreshCaptcha();b.trigger("rte-destroyed");b.unbind("rte-destroyed")})}};return n});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/quick-edit","AJS.Confluence.QuickEdit");