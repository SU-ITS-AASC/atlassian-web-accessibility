define("confluence-ui-components/js/user-group-select2",["ajs","confluence/legacy","jquery"],function(a,d,b){function c(f){f=f||document.body;var e=function(){var g=b(".select2-drop-active > .select2-results");if(g.children(".select2-result-selectable").length===0&&g.children(".select2-disabled").length){g.append('<li class="select2-no-results">'+a.escapeHtml(a.I18n.getText("usersearch.no.results"))+"</li>")}};b("input.autocomplete-multiusergroup[data-autocomplete-bound != 'true']",f).each(function(){var g=b(this);g.attr("data-autocomplete-bound","true");var h=g.attr("data-include-groups");g.auiSelect2({multiple:true,minimumInputLength:2,formatInputTooShort:function(){return h?a.I18n.getText("confluence-ui-components.user-group-select2.usergroup.prompt"):a.I18n.getText("confluence-ui-components.user-group-select2.user.prompt")},ajax:{transport:function(l){var m=l.success;delete l.success;return b.ajax.apply(b.ajax,arguments).done(m).done(e)},data:function(l){return{"max-results":6,query:l}},dataType:"json",url:d.getContextPath()+"/rest/prototype/1/search/user"+(h?"-or-group":"")+".json",results:function(m){var l=[];b.each(m.result,function(){if(this.type=="user"){l.push({id:this.username,text:this.title,imgSrc:this.thumbnailLink.href,entity:this})}else{l.push({id:this.name,text:this.name,imgSrc:a.contextPath()+"/images/icons/avatar_group_48.png",entity:this})}});return{results:l}},quietMillis:300},formatResult:function(l){return d.UI.Components.UserGroupSelect2.avatarWithName({size:"small",displayName:l.text,userId:l.id,avatarImageUrl:l.imgSrc})},escapeMarkup:function(l){return l},formatSelection:function(l){return d.UI.Components.UserGroupSelect2.avatarWithName({size:"xsmall",displayName:l.text,userId:l.id,avatarImageUrl:l.imgSrc})},dropdownCssClass:"users-dropdown",containerCssClass:"users-autocomplete",hasAvatar:true});if(!g.data("autofill-user")){return}var k=a.Meta.get("remote-user"),j=a.Meta.get("current-user-fullname"),i=a.Meta.get("current-user-avatar-uri-reference");if(k&&j&&i){g.auiSelect2("data",[{id:k,text:j,imgSrc:i}])}})}return{bind:c}});