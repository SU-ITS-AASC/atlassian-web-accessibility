(function(f){AJS.$(function(g){g("#qunit-fixture").append("<div id='test-space-page-picker'></div>")});AJS.test.require("com.atlassian.confluence.plugins.confluence-ui-components:space-page-picker",AJS.$.noop);var b=function(){this.sandbox=sinon.sandbox.create();this.xhr=sinon.useFakeXMLHttpRequest();var g=this.requests=[];this.xhr.onCreate=function(h){g.push(h)}};var c=function(){this.sandbox.restore();this.xhr.restore()};var d;var e;var a={setup:function(){b.call(this);d=f("#test-space-page-picker");e=f('<input id="space-page-picker-component">');d.append(e)},teardown:function(){d.empty();c.call(this)}};module("Confluence.UI.Components.SpacePagePicker",a);test("test options with orgElement only",function(){var g={orgElement:e};e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(g));var j=f("#space-page-picker-componentSpaceCat");var h=f("#space-page-picker-componentSpace");var i=f("#space-page-picker-componentPage");ok(j.length===1);ok(h.length===1);ok(i.length===1);ok(e.val()==="");ok(j.val()==="");ok(h.val()==="");ok(i.val()==="")});test("test options with orgElement; pre-fill by javascript",function(){var g={orgElement:e,spaceCatKeys:["conf_all"],spaceKeys:["TST"],pageIds:["1234567"]};e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(g));this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");var j=f("#space-page-picker-componentSpaceCat");var h=f("#space-page-picker-componentSpace");var i=f("#space-page-picker-componentPage");ok(j.length===1);ok(h.length===1);ok(i.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(j.val()==="conf_all");ok(h.val()==="TST");ok(i.val()==="1234567")});test("test options with orgElement; pre-fill by input hidden fields",function(){var i={orgElement:e};var m=f('<input type="hidden" id="space-page-picker-componentSpaceCat" value="conf_all">');var h=f('<input type="hidden" id="space-page-picker-componentSpace" value="TST">');var g=f('<input type="hidden" id="space-page-picker-componentPage" value="1234567">');e.after(m).after(h).after(g);e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(i));this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");var l=f("#space-page-picker-componentSpaceCat");var j=f("#space-page-picker-componentSpace");var k=f("#space-page-picker-componentPage");ok(l.length===1);ok(j.length===1);ok(k.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(l.val()==="conf_all");ok(j.val()==="TST");ok(k.val()==="1234567")});test("test options with orgElement; pre-fill in the component",function(){var g={orgElement:e};e.val("space-cat:conf_all,space:TST,page:1234567");e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(g));this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");var j=f("#space-page-picker-componentSpaceCat");var h=f("#space-page-picker-componentSpace");var i=f("#space-page-picker-componentPage");ok(j.length===1);ok(h.length===1);ok(i.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(j.val()==="conf_all");ok(h.val()==="TST");ok(i.val()==="1234567")});test("test options with orgElement; pre-fill by all ways",function(){var i={orgElement:e,spaceCatKeys:["conf_all"],spaceKeys:["TST"],pageIds:["1234567"]};e.val("space-cat:conf_global,space:TST2,page:2234567");var m=f('<input type="hidden" id="space-page-picker-componentSpaceCat" value="conf_personal">');var h=f('<input type="hidden" id="space-page-picker-componentSpace" value="TST3">');var g=f('<input type="hidden" id="space-page-picker-componentPage" value="3234567">');e.after(m).after(h).after(g);e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(i));this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST2', name: 'Test Space2'},{key: 'TST', name: 'Test Space'},{key: 'TST3', name: 'Test Space3'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '2234567', title: 'Test Page2' }");this.requests[2].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");this.requests[3].respond(200,{"Content-Type":"application/json"},"{ id: '31234567', title: 'Test Page3' }");var l=f("#space-page-picker-componentSpaceCat");var j=f("#space-page-picker-componentSpace");var k=f("#space-page-picker-componentPage");ok(l.length===1);ok(j.length===1);ok(k.length===1);ok(e.val()==="space-cat:conf_global,space:TST2,page:2234567,space-cat:conf_all,space-cat:conf_personal,space:TST,space:TST3,page:1234567,page:3234567");ok(l.val()==="conf_global,conf_all,conf_personal");ok(j.val()==="TST2,TST,TST3");ok(k.val()==="2234567,1234567,3234567")});test("test options with orgElement; pre-fill by all ways with empty values",function(){var i={orgElement:e,spaceCatKeys:[],spaceKeys:[],pageIds:[]};e.val("");var m=f('<input type="hidden" id="space-page-picker-componentSpaceCat">');var h=f('<input type="hidden" id="space-page-picker-componentSpace">');var g=f('<input type="hidden" id="space-page-picker-componentPage">');e.after(m).after(h).after(g);e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(i));var l=f("#space-page-picker-componentSpaceCat");var j=f("#space-page-picker-componentSpace");var k=f("#space-page-picker-componentPage");ok(l.length===1);ok(j.length===1);ok(k.length===1);ok(e.val()==="");ok(l.val()==="");ok(j.val()==="");ok(k.val()==="")});test("test options with orgElement; pre-fill by all ways with duplicate values",function(){var i={orgElement:e,spaceCatKeys:["conf_all"],spaceKeys:["TST"],pageIds:["1234567"]};e.val("space-cat:conf_all,space:TST,page:1234567");var m=f('<input type="hidden" id="space-page-picker-componentSpaceCat" value="conf_all">');var h=f('<input type="hidden" id="space-page-picker-componentSpace" value="TST">');var g=f('<input type="hidden" id="space-page-picker-componentPage" value="1234567">');d.append(m).append(h).append(g);e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(i));this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");var l=f("#space-page-picker-componentSpaceCat");var j=f("#space-page-picker-componentSpace");var k=f("#space-page-picker-componentPage");ok(l.length===1);ok(j.length===1);ok(k.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(l.val()==="conf_all");ok(j.val()==="TST");ok(k.val()==="1234567")});test("test options with orgElement, predefined input hidden field names; pre-fill by all ways with duplicate values",function(){var i={orgElement:e,spaceCatKeys:["conf_all"],spaceKeys:["TST"],pageIds:["1234567"],inputSpaceCatId:"spaceCats",inputSpaceId:"spaces",inputPageId:"pages"};e.val("space-cat:conf_all,space:TST,page:1234567");var m=f('<input type="hidden" id="spaceCats" value="conf_all">');var h=f('<input type="hidden" id="spaces" value="TST">');var g=f('<input type="hidden" id="pages" value="1234567">');d.append(m).append(h).append(g);e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(i));this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");var l=f("#spaceCats");var j=f("#spaces");var k=f("#pages");ok(l.length===1);ok(j.length===1);ok(k.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(l.val()==="conf_all");ok(j.val()==="TST");ok(k.val()==="1234567")});test("test options with orgElement, predefined input hidden field names; pre-fill by javascript",function(){var g={orgElement:e,spaceCatKeys:["conf_all"],spaceKeys:["TST"],pageIds:["1234567"],inputSpaceCatId:"spaceCats",inputSpaceId:"spaces",inputPageId:"pages"};e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(g));this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");var j=f("#spaceCats");var h=f("#spaces");var i=f("#pages");ok(j.length===1);ok(h.length===1);ok(i.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(j.val()==="conf_all");ok(h.val()==="TST");ok(i.val()==="1234567")});test("test options with orgElement, predefined input hidden field names, manualInit; pre-fill by input hidden fields; setValue with normal values",function(){var i={orgElement:e,inputSpaceCatId:"spaceCats",inputSpaceId:"spaces",inputPageId:"pages",manualInit:true};var m=f('<input type="hidden" id="spaceCats" value="conf_all">');var h=f('<input type="hidden" id="spaces" value="TST">');var g=f('<input type="hidden" id="pages" value="1234567">');d.append(m).append(h).append(g);e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(i));Confluence.UI.Components.SpacePagePicker.setValue("space-cat:conf_all,space:TST,page:1234567",e);this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");var l=f("#spaceCats");var j=f("#spaces");var k=f("#pages");ok(l.length===1);ok(j.length===1);ok(k.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(l.val()==="conf_all");ok(j.val()==="TST");ok(k.val()==="1234567")});test("test options with orgElement, predefined input hidden field names, manualInit; pre-fill by input hidden fields; setValue with trigger value",function(){var i={orgElement:e,inputSpaceCatId:"spaceCats",inputSpaceId:"spaces",inputPageId:"pages",manualInit:true};var m=f('<input type="hidden" id="spaceCats" value="conf_all">');var h=f('<input type="hidden" id="spaces" value="TST">');var g=f('<input type="hidden" id="pages" value="1234567">');d.append(m).append(h).append(g);e.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(i));var l=f("#spaceCats");var j=f("#spaces");var k=f("#pages");ok(e.val()==="");Confluence.UI.Components.SpacePagePicker.setValue("SPACE-PAGE-TRIGGER-VALUE",e);this.requests[0].respond(200,{"Content-Type":"application/json"},"[{key: 'TST', name: 'Test Space'}]");this.requests[1].respond(200,{"Content-Type":"application/json"},"{ id: '1234567', title: 'Test Page' }");ok(l.length===1);ok(j.length===1);ok(k.length===1);ok(e.val()==="space-cat:conf_all,space:TST,page:1234567");ok(l.val()==="conf_all");ok(j.val()==="TST");ok(k.val()==="1234567")})}(AJS.$));